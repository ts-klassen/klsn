#{to_json =>
   {with_defs,
    {#{<<"ApplyPatchApprovalParams">> =>
        {struct,
         #{callId => {required,binstr},
           conversationId => {required,{ref,<<"ThreadId">>}},
           fileChanges =>
            {required,{map,{binstr,{ref,<<"FileChange">>}}}},
           grantRoot => {optional,{any_of,[binstr,{exact,null}]}},
           reason => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshParams">> =>
        {struct,
         #{reason =>
            {required,{ref,<<"ChatgptAuthTokensRefreshReason">>}},
           previousAccountId => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshReason">> =>
        {any_of,[{enum,[<<"unauthorized">>]}]},
       <<"CommandAction">> =>
        {any_of,
         [{struct,
           #{command => {required,binstr},
             name => {required,binstr},
             path => {required,binstr},
             type => {required,{enum,[<<"read">>]}}}},
          {struct,
           #{command => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"listFiles">>]}}}},
          {struct,
           #{command => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             query => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"search">>]}}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[<<"unknown">>]}}}}]},
       <<"CommandExecutionRequestApprovalParams">> =>
        {struct,
         #{command => {optional,{any_of,[binstr,{exact,null}]}},
           commandActions =>
            {optional,
             {any_of,[{list,{ref,<<"CommandAction">>}},{exact,null}]}},
           cwd => {optional,{any_of,[binstr,{exact,null}]}},
           itemId => {required,binstr},
           proposedExecpolicyAmendment =>
            {optional,{any_of,[{list,binstr},{exact,null}]}},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr}}},
       <<"DynamicToolCallParams">> =>
        {struct,
         #{arguments => {required,term},
           callId => {required,binstr},
           threadId => {required,binstr},
           tool => {required,binstr},
           turnId => {required,binstr}}},
       <<"ExecCommandApprovalParams">> =>
        {struct,
         #{callId => {required,binstr},
           command => {required,{list,binstr}},
           conversationId => {required,{ref,<<"ThreadId">>}},
           cwd => {required,binstr},
           parsedCmd => {required,{list,{ref,<<"ParsedCommand">>}}},
           reason => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"FileChange">> =>
        {any_of,
         [{struct,
           #{content => {required,binstr},
             type => {required,{enum,[<<"add">>]}}}},
          {struct,
           #{content => {required,binstr},
             type => {required,{enum,[<<"delete">>]}}}},
          {struct,
           #{move_path => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"update">>]}},
             unified_diff => {required,binstr}}}]},
       <<"FileChangeRequestApprovalParams">> =>
        {struct,
         #{grantRoot => {optional,{any_of,[binstr,{exact,null}]}},
           itemId => {required,binstr},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr}}},
       <<"ParsedCommand">> =>
        {any_of,
         [{struct,
           #{cmd => {required,binstr},
             name => {required,binstr},
             path => {required,binstr},
             type => {required,{enum,[<<"read">>]}}}},
          {struct,
           #{cmd => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"list_files">>]}}}},
          {struct,
           #{cmd => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             query => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"search">>]}}}},
          {struct,
           #{cmd => {required,binstr},
             type => {required,{enum,[<<"unknown">>]}}}}]},
       <<"RequestId">> => {any_of,[binstr,integer]},
       <<"ThreadId">> => binstr,
       <<"ToolRequestUserInputOption">> =>
        {struct,
         #{label => {required,binstr},description => {required,binstr}}},
       <<"ToolRequestUserInputParams">> =>
        {struct,
         #{itemId => {required,binstr},
           questions =>
            {required,{list,{ref,<<"ToolRequestUserInputQuestion">>}}},
           threadId => {required,binstr},
           turnId => {required,binstr}}},
       <<"ToolRequestUserInputQuestion">> =>
        {struct,
         #{id => {required,binstr},
           header => {required,binstr},
           options =>
            {optional,
             {any_of,
              [{list,{ref,<<"ToolRequestUserInputOption">>}},{exact,null}]}},
           isOther => {optional,{default,{false,boolean}}},
           isSecret => {optional,{default,{false,boolean}}},
           question => {required,binstr}}}},
     {any_of,
      [{struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method =>
           {required,{enum,[<<"item/commandExecution/requestApproval">>]}},
          params =>
           {required,{ref,<<"CommandExecutionRequestApprovalParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method =>
           {required,{enum,[<<"item/fileChange/requestApproval">>]}},
          params =>
           {required,{ref,<<"FileChangeRequestApprovalParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"item/tool/requestUserInput">>]}},
          params => {required,{ref,<<"ToolRequestUserInputParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"item/tool/call">>]}},
          params => {required,{ref,<<"DynamicToolCallParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method =>
           {required,{enum,[<<"account/chatgptAuthTokens/refresh">>]}},
          params => {required,{ref,<<"ChatgptAuthTokensRefreshParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"applyPatchApproval">>]}},
          params => {required,{ref,<<"ApplyPatchApprovalParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"execCommandApproval">>]}},
          params => {required,{ref,<<"ExecCommandApprovalParams">>}}}}]}}},
  from_json =>
   {with_defs,
    {#{<<"ApplyPatchApprovalParams">> =>
        {struct,
         #{callId => {required,binstr},
           conversationId => {required,{ref,<<"ThreadId">>}},
           fileChanges =>
            {required,{map,{binstr,{ref,<<"FileChange">>}}}},
           grantRoot => {optional,{any_of,[binstr,{exact,null}]}},
           reason => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshParams">> =>
        {struct,
         #{reason =>
            {required,{ref,<<"ChatgptAuthTokensRefreshReason">>}},
           previousAccountId => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshReason">> =>
        {any_of,[{enum,[<<"unauthorized">>]}]},
       <<"CommandAction">> =>
        {any_of,
         [{struct,
           #{command => {required,binstr},
             name => {required,binstr},
             path => {required,binstr},
             type => {required,{enum,[<<"read">>]}}}},
          {struct,
           #{command => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"listFiles">>]}}}},
          {struct,
           #{command => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             query => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"search">>]}}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[<<"unknown">>]}}}}]},
       <<"CommandExecutionRequestApprovalParams">> =>
        {struct,
         #{command => {optional,{any_of,[binstr,{exact,null}]}},
           commandActions =>
            {optional,
             {any_of,[{list,{ref,<<"CommandAction">>}},{exact,null}]}},
           cwd => {optional,{any_of,[binstr,{exact,null}]}},
           itemId => {required,binstr},
           proposedExecpolicyAmendment =>
            {optional,{any_of,[{list,binstr},{exact,null}]}},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr}}},
       <<"DynamicToolCallParams">> =>
        {struct,
         #{arguments => {required,term},
           callId => {required,binstr},
           threadId => {required,binstr},
           tool => {required,binstr},
           turnId => {required,binstr}}},
       <<"ExecCommandApprovalParams">> =>
        {struct,
         #{callId => {required,binstr},
           command => {required,{list,binstr}},
           conversationId => {required,{ref,<<"ThreadId">>}},
           cwd => {required,binstr},
           parsedCmd => {required,{list,{ref,<<"ParsedCommand">>}}},
           reason => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"FileChange">> =>
        {any_of,
         [{struct,
           #{content => {required,binstr},
             type => {required,{enum,[<<"add">>]}}}},
          {struct,
           #{content => {required,binstr},
             type => {required,{enum,[<<"delete">>]}}}},
          {struct,
           #{move_path => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"update">>]}},
             unified_diff => {required,binstr}}}]},
       <<"FileChangeRequestApprovalParams">> =>
        {struct,
         #{grantRoot => {optional,{any_of,[binstr,{exact,null}]}},
           itemId => {required,binstr},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr}}},
       <<"ParsedCommand">> =>
        {any_of,
         [{struct,
           #{cmd => {required,binstr},
             name => {required,binstr},
             path => {required,binstr},
             type => {required,{enum,[<<"read">>]}}}},
          {struct,
           #{cmd => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"list_files">>]}}}},
          {struct,
           #{cmd => {required,binstr},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             query => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"search">>]}}}},
          {struct,
           #{cmd => {required,binstr},
             type => {required,{enum,[<<"unknown">>]}}}}]},
       <<"RequestId">> => {any_of,[binstr,integer]},
       <<"ThreadId">> => binstr,
       <<"ToolRequestUserInputOption">> =>
        {struct,
         #{label => {required,binstr},description => {required,binstr}}},
       <<"ToolRequestUserInputParams">> =>
        {struct,
         #{itemId => {required,binstr},
           questions =>
            {required,{list,{ref,<<"ToolRequestUserInputQuestion">>}}},
           threadId => {required,binstr},
           turnId => {required,binstr}}},
       <<"ToolRequestUserInputQuestion">> =>
        {struct,
         #{id => {required,binstr},
           header => {required,binstr},
           options =>
            {optional,
             {any_of,
              [{list,{ref,<<"ToolRequestUserInputOption">>}},{exact,null}]}},
           isOther => {optional,{default,{false,boolean}}},
           isSecret => {optional,{default,{false,boolean}}},
           question => {required,binstr}}}},
     {any_of,
      [{struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method =>
           {required,{enum,[<<"item/commandExecution/requestApproval">>]}},
          params =>
           {required,{ref,<<"CommandExecutionRequestApprovalParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method =>
           {required,{enum,[<<"item/fileChange/requestApproval">>]}},
          params =>
           {required,{ref,<<"FileChangeRequestApprovalParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"item/tool/requestUserInput">>]}},
          params => {required,{ref,<<"ToolRequestUserInputParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"item/tool/call">>]}},
          params => {required,{ref,<<"DynamicToolCallParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method =>
           {required,{enum,[<<"account/chatgptAuthTokens/refresh">>]}},
          params => {required,{ref,<<"ChatgptAuthTokensRefreshParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"applyPatchApproval">>]}},
          params => {required,{ref,<<"ApplyPatchApprovalParams">>}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          method => {required,{enum,[<<"execCommandApproval">>]}},
          params => {required,{ref,<<"ExecCommandApprovalParams">>}}}}]}}}}.
