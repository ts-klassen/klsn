#{to_json =>
   {with_defs,
    {#{<<"ApplyPatchApprovalParams">> =>
        {struct,
         #{reason => {optional,{any_of,[binstr,{exact,null}]}},
           callId => {required,binstr},
           conversationId => {required,{ref,<<"ThreadId">>}},
           fileChanges => {required,{map,{binstr,{ref,<<"FileChange">>}}}},
           grantRoot => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshParams">> =>
        {struct,
         #{reason => {required,{ref,<<"ChatgptAuthTokensRefreshReason">>}},
           previousAccountId => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshReason">> =>
        {any_of,[{enum,[unauthorized]}]},
       <<"CommandAction">> =>
        {any_of,
         [{struct,
           #{command => {required,binstr},
             name => {required,binstr},
             type => {required,{enum,[read]}},
             path => {required,binstr}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[listFiles]}},
             path => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[search]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             query => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[unknown]}}}}]},
       <<"CommandExecutionRequestApprovalParams">> =>
        {struct,
         #{command => {optional,{any_of,[binstr,{exact,null}]}},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           cwd => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr},
           commandActions =>
            {optional,
             {any_of,[{list,{ref,<<"CommandAction">>}},{exact,null}]}},
           itemId => {required,binstr},
           proposedExecpolicyAmendment =>
            {optional,{any_of,[{list,binstr},{exact,null}]}}}},
       <<"DynamicToolCallParams">> =>
        {struct,
         #{arguments => {required,term},
           callId => {required,binstr},
           threadId => {required,binstr},
           turnId => {required,binstr},
           tool => {required,binstr}}},
       <<"ExecCommandApprovalParams">> =>
        {struct,
         #{command => {required,{list,binstr}},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           cwd => {required,binstr},
           callId => {required,binstr},
           conversationId => {required,{ref,<<"ThreadId">>}},
           parsedCmd => {required,{list,{ref,<<"ParsedCommand">>}}}}},
       <<"FileChange">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[add]}},content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[delete]}},content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[update]}},
             move_path => {optional,{any_of,[binstr,{exact,null}]}},
             unified_diff => {required,binstr}}}]},
       <<"FileChangeRequestApprovalParams">> =>
        {struct,
         #{reason => {optional,{any_of,[binstr,{exact,null}]}},
           grantRoot => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr},
           itemId => {required,binstr}}},
       <<"ParsedCommand">> =>
        {any_of,
         [{struct,
           #{name => {required,binstr},
             type => {required,{enum,[read]}},
             path => {required,binstr},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[list_files]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[search]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr},
             query => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[unknown]}},cmd => {required,binstr}}}]},
       <<"RequestId">> => {any_of,[binstr,integer]},
       <<"ThreadId">> => binstr,
       <<"ToolRequestUserInputOption">> =>
        {struct,
         #{label => {required,binstr},description => {required,binstr}}},
       <<"ToolRequestUserInputParams">> =>
        {struct,
         #{threadId => {required,binstr},
           turnId => {required,binstr},
           itemId => {required,binstr},
           questions =>
            {required,{list,{ref,<<"ToolRequestUserInputQuestion">>}}}}},
       <<"ToolRequestUserInputQuestion">> =>
        {struct,
         #{id => {required,binstr},
           header => {required,binstr},
           options =>
            {optional,
             {any_of,
              [{list,{ref,<<"ToolRequestUserInputOption">>}},{exact,null}]}},
           question => {required,binstr},
           isOther => {optional,{default,{false,boolean}}},
           isSecret => {optional,{default,{false,boolean}}}}}},
     {any_of,
      [{struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params =>
           {required,{ref,<<"CommandExecutionRequestApprovalParams">>}},
          method =>
           {required,{enum,['item/commandExecution/requestApproval']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"FileChangeRequestApprovalParams">>}},
          method => {required,{enum,['item/fileChange/requestApproval']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ToolRequestUserInputParams">>}},
          method => {required,{enum,['item/tool/requestUserInput']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"DynamicToolCallParams">>}},
          method => {required,{enum,['item/tool/call']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ChatgptAuthTokensRefreshParams">>}},
          method => {required,{enum,['account/chatgptAuthTokens/refresh']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ApplyPatchApprovalParams">>}},
          method => {required,{enum,[applyPatchApproval]}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ExecCommandApprovalParams">>}},
          method => {required,{enum,[execCommandApproval]}}}}]}}},
  from_json =>
   {with_defs,
    {#{<<"ApplyPatchApprovalParams">> =>
        {struct,
         #{reason => {optional,{any_of,[binstr,{exact,null}]}},
           callId => {required,binstr},
           conversationId => {required,{ref,<<"ThreadId">>}},
           fileChanges => {required,{map,{binstr,{ref,<<"FileChange">>}}}},
           grantRoot => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshParams">> =>
        {struct,
         #{reason => {required,{ref,<<"ChatgptAuthTokensRefreshReason">>}},
           previousAccountId => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ChatgptAuthTokensRefreshReason">> =>
        {any_of,[{enum,[unauthorized]}]},
       <<"CommandAction">> =>
        {any_of,
         [{struct,
           #{command => {required,binstr},
             name => {required,binstr},
             type => {required,{enum,[read]}},
             path => {required,binstr}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[listFiles]}},
             path => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[search]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             query => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{command => {required,binstr},
             type => {required,{enum,[unknown]}}}}]},
       <<"CommandExecutionRequestApprovalParams">> =>
        {struct,
         #{command => {optional,{any_of,[binstr,{exact,null}]}},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           cwd => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr},
           commandActions =>
            {optional,
             {any_of,[{list,{ref,<<"CommandAction">>}},{exact,null}]}},
           itemId => {required,binstr},
           proposedExecpolicyAmendment =>
            {optional,{any_of,[{list,binstr},{exact,null}]}}}},
       <<"DynamicToolCallParams">> =>
        {struct,
         #{arguments => {required,term},
           callId => {required,binstr},
           threadId => {required,binstr},
           turnId => {required,binstr},
           tool => {required,binstr}}},
       <<"ExecCommandApprovalParams">> =>
        {struct,
         #{command => {required,{list,binstr}},
           reason => {optional,{any_of,[binstr,{exact,null}]}},
           cwd => {required,binstr},
           callId => {required,binstr},
           conversationId => {required,{ref,<<"ThreadId">>}},
           parsedCmd => {required,{list,{ref,<<"ParsedCommand">>}}}}},
       <<"FileChange">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[add]}},content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[delete]}},content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[update]}},
             move_path => {optional,{any_of,[binstr,{exact,null}]}},
             unified_diff => {required,binstr}}}]},
       <<"FileChangeRequestApprovalParams">> =>
        {struct,
         #{reason => {optional,{any_of,[binstr,{exact,null}]}},
           grantRoot => {optional,{any_of,[binstr,{exact,null}]}},
           threadId => {required,binstr},
           turnId => {required,binstr},
           itemId => {required,binstr}}},
       <<"ParsedCommand">> =>
        {any_of,
         [{struct,
           #{name => {required,binstr},
             type => {required,{enum,[read]}},
             path => {required,binstr},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[list_files]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[search]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr},
             query => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[unknown]}},cmd => {required,binstr}}}]},
       <<"RequestId">> => {any_of,[binstr,integer]},
       <<"ThreadId">> => binstr,
       <<"ToolRequestUserInputOption">> =>
        {struct,
         #{label => {required,binstr},description => {required,binstr}}},
       <<"ToolRequestUserInputParams">> =>
        {struct,
         #{threadId => {required,binstr},
           turnId => {required,binstr},
           itemId => {required,binstr},
           questions =>
            {required,{list,{ref,<<"ToolRequestUserInputQuestion">>}}}}},
       <<"ToolRequestUserInputQuestion">> =>
        {struct,
         #{id => {required,binstr},
           header => {required,binstr},
           options =>
            {optional,
             {any_of,
              [{list,{ref,<<"ToolRequestUserInputOption">>}},{exact,null}]}},
           question => {required,binstr},
           isOther => {optional,{default,{false,boolean}}},
           isSecret => {optional,{default,{false,boolean}}}}}},
     {any_of,
      [{struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params =>
           {required,{ref,<<"CommandExecutionRequestApprovalParams">>}},
          method =>
           {required,{enum,['item/commandExecution/requestApproval']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"FileChangeRequestApprovalParams">>}},
          method => {required,{enum,['item/fileChange/requestApproval']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ToolRequestUserInputParams">>}},
          method => {required,{enum,['item/tool/requestUserInput']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"DynamicToolCallParams">>}},
          method => {required,{enum,['item/tool/call']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ChatgptAuthTokensRefreshParams">>}},
          method => {required,{enum,['account/chatgptAuthTokens/refresh']}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ApplyPatchApprovalParams">>}},
          method => {required,{enum,[applyPatchApproval]}}}},
       {struct,
        #{id => {required,{ref,<<"RequestId">>}},
          params => {required,{ref,<<"ExecCommandApprovalParams">>}},
          method => {required,{enum,[execCommandApproval]}}}}]}}}}.
