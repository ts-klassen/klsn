#{to_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"NetworkAccess">> => {enum,[<<"restricted">>,<<"enabled">>]},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[<<"danger-full-access">>]}}}},
          {struct,#{type => {required,{enum,[<<"read-only">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"external-sandbox">>]}},
             network_access =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"workspace-write">>]}},
             network_access => {optional,{default,{false,boolean}}},
             exclude_slash_tmp => {optional,{default,{false,boolean}}},
             exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
             writable_roots =>
              {optional,{list,{ref,<<"AbsolutePathBuf">>}}}}}]}},
     {struct,
      #{command => {required,{list,binstr}},
        cwd => {optional,{any_of,[binstr,{exact,null}]}},
        sandboxPolicy =>
         {optional,{any_of,[{ref,<<"SandboxPolicy">>},{exact,null}]}},
        timeoutMs => {optional,{any_of,[integer,{exact,null}]}}}}}},
  from_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"NetworkAccess">> => {enum,[<<"restricted">>,<<"enabled">>]},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[<<"danger-full-access">>]}}}},
          {struct,#{type => {required,{enum,[<<"read-only">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"external-sandbox">>]}},
             network_access =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"workspace-write">>]}},
             network_access => {optional,{default,{false,boolean}}},
             exclude_slash_tmp => {optional,{default,{false,boolean}}},
             exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
             writable_roots =>
              {optional,{list,{ref,<<"AbsolutePathBuf">>}}}}}]}},
     {struct,
      #{command => {required,{list,binstr}},
        cwd => {optional,{any_of,[binstr,{exact,null}]}},
        sandboxPolicy =>
         {optional,{any_of,[{ref,<<"SandboxPolicy">>},{exact,null}]}},
        timeoutMs => {optional,{any_of,[integer,{exact,null}]}}}}}}}.
