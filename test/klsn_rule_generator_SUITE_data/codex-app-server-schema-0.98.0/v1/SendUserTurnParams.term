#{to_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"AskForApproval">> =>
        {any_of,
         [{enum,[untrusted]},
          {enum,['on-failure']},
          {enum,['on-request']},
          {enum,[never]}]},
       <<"InputItem">> =>
        {any_of,
         [{struct,
           #{data =>
              {required,
               {struct,
                #{text => {required,binstr},
                  text_elements =>
                   {optional,
                    {default,{[],{list,{ref,<<"V1TextElement">>}}}}}}}},
             type => {required,{enum,[text]}}}},
          {struct,
           #{data => {required,{struct,#{image_url => {required,binstr}}}},
             type => {required,{enum,[image]}}}},
          {struct,
           #{data => {required,{struct,#{path => {required,binstr}}}},
             type => {required,{enum,[localImage]}}}}]},
       <<"NetworkAccess">> => {enum,[restricted,enabled]},
       <<"ReasoningEffort">> => {enum,[none,minimal,low,medium,high,xhigh]},
       <<"ReasoningSummary">> =>
        {any_of,[{enum,[auto,concise,detailed]},{enum,[none]}]},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,['danger-full-access']}}}},
          {struct,#{type => {required,{enum,['read-only']}}}},
          {struct,
           #{type => {required,{enum,['external-sandbox']}},
             network_access =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,['workspace-write']}},
             network_access => {optional,{default,{false,boolean}}},
             exclude_slash_tmp => {optional,{default,{false,boolean}}},
             exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
             writable_roots =>
              {optional,{list,{ref,<<"AbsolutePathBuf">>}}}}}]},
       <<"ThreadId">> => binstr,
       <<"V1ByteRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"V1TextElement">> =>
        {struct,
         #{byteRange => {required,{all_of,[{ref,<<"V1ByteRange">>}]}},
           placeholder => {optional,{any_of,[binstr,{exact,null}]}}}}},
     {struct,
      #{items => {required,{list,{ref,<<"InputItem">>}}},
        cwd => {required,binstr},
        conversationId => {required,{ref,<<"ThreadId">>}},
        model => {required,binstr},
        summary => {required,{ref,<<"ReasoningSummary">>}},
        sandboxPolicy => {required,{ref,<<"SandboxPolicy">>}},
        approvalPolicy => {required,{ref,<<"AskForApproval">>}},
        effort =>
         {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
        outputSchema => {optional,term}}}}},
  from_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"AskForApproval">> =>
        {any_of,
         [{enum,[untrusted]},
          {enum,['on-failure']},
          {enum,['on-request']},
          {enum,[never]}]},
       <<"InputItem">> =>
        {any_of,
         [{struct,
           #{data =>
              {required,
               {struct,
                #{text => {required,binstr},
                  text_elements =>
                   {optional,
                    {default,{[],{list,{ref,<<"V1TextElement">>}}}}}}}},
             type => {required,{enum,[text]}}}},
          {struct,
           #{data => {required,{struct,#{image_url => {required,binstr}}}},
             type => {required,{enum,[image]}}}},
          {struct,
           #{data => {required,{struct,#{path => {required,binstr}}}},
             type => {required,{enum,[localImage]}}}}]},
       <<"NetworkAccess">> => {enum,[restricted,enabled]},
       <<"ReasoningEffort">> => {enum,[none,minimal,low,medium,high,xhigh]},
       <<"ReasoningSummary">> =>
        {any_of,[{enum,[auto,concise,detailed]},{enum,[none]}]},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,['danger-full-access']}}}},
          {struct,#{type => {required,{enum,['read-only']}}}},
          {struct,
           #{type => {required,{enum,['external-sandbox']}},
             network_access =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,['workspace-write']}},
             network_access => {optional,{default,{false,boolean}}},
             exclude_slash_tmp => {optional,{default,{false,boolean}}},
             exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
             writable_roots =>
              {optional,{list,{ref,<<"AbsolutePathBuf">>}}}}}]},
       <<"ThreadId">> => binstr,
       <<"V1ByteRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"V1TextElement">> =>
        {struct,
         #{byteRange => {required,{all_of,[{ref,<<"V1ByteRange">>}]}},
           placeholder => {optional,{any_of,[binstr,{exact,null}]}}}}},
     {struct,
      #{items => {required,{list,{ref,<<"InputItem">>}}},
        cwd => {required,binstr},
        conversationId => {required,{ref,<<"ThreadId">>}},
        model => {required,binstr},
        summary => {required,{ref,<<"ReasoningSummary">>}},
        sandboxPolicy => {required,{ref,<<"SandboxPolicy">>}},
        approvalPolicy => {required,{ref,<<"AskForApproval">>}},
        effort =>
         {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
        outputSchema => {optional,term}}}}}}.
