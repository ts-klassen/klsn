#{to_json =>
      {with_defs,
          {#{<<"AskForApproval">> =>
                 {any_of,
                     [{enum,[<<"untrusted">>]},
                      {enum,[<<"on-failure">>]},
                      {enum,[<<"on-request">>]},
                      {enum,[<<"never">>]}]},
             <<"NewConversationParams">> =>
                 {struct,
                     #{profile => {optional,{any_of,[binstr,{exact,null}]}},
                       config =>
                           {optional,
                               {any_of,[{map,{binstr,term}},{exact,null}]}},
                       cwd => {optional,{any_of,[binstr,{exact,null}]}},
                       model => {optional,{any_of,[binstr,{exact,null}]}},
                       approvalPolicy =>
                           {optional,
                               {any_of,
                                   [{ref,<<"AskForApproval">>},{exact,null}]}},
                       baseInstructions =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       compactPrompt =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       developerInstructions =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       includeApplyPatchTool =>
                           {optional,{any_of,[boolean,{exact,null}]}},
                       modelProvider =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       sandbox =>
                           {optional,
                               {any_of,
                                   [{ref,<<"SandboxMode">>},{exact,null}]}}}},
             <<"SandboxMode">> =>
                 {enum,
                     [<<"read-only">>,<<"workspace-write">>,
                      <<"danger-full-access">>]},
             <<"ThreadId">> => binstr},
           {struct,
               #{path => {optional,{any_of,[binstr,{exact,null}]}},
                 conversationId =>
                     {optional,{any_of,[{ref,<<"ThreadId">>},{exact,null}]}},
                 overrides =>
                     {optional,
                         {any_of,
                             [{ref,<<"NewConversationParams">>},
                              {exact,null}]}}}}}},
  from_json =>
      {with_defs,
          {#{<<"AskForApproval">> =>
                 {any_of,
                     [{enum,[<<"untrusted">>]},
                      {enum,[<<"on-failure">>]},
                      {enum,[<<"on-request">>]},
                      {enum,[<<"never">>]}]},
             <<"NewConversationParams">> =>
                 {struct,
                     #{profile => {optional,{any_of,[binstr,{exact,null}]}},
                       config =>
                           {optional,
                               {any_of,[{map,{binstr,term}},{exact,null}]}},
                       cwd => {optional,{any_of,[binstr,{exact,null}]}},
                       model => {optional,{any_of,[binstr,{exact,null}]}},
                       approvalPolicy =>
                           {optional,
                               {any_of,
                                   [{ref,<<"AskForApproval">>},{exact,null}]}},
                       baseInstructions =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       compactPrompt =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       developerInstructions =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       includeApplyPatchTool =>
                           {optional,{any_of,[boolean,{exact,null}]}},
                       modelProvider =>
                           {optional,{any_of,[binstr,{exact,null}]}},
                       sandbox =>
                           {optional,
                               {any_of,
                                   [{ref,<<"SandboxMode">>},{exact,null}]}}}},
             <<"SandboxMode">> =>
                 {enum,
                     [<<"read-only">>,<<"workspace-write">>,
                      <<"danger-full-access">>]},
             <<"ThreadId">> => binstr},
           {struct,
               #{path => {optional,{any_of,[binstr,{exact,null}]}},
                 conversationId =>
                     {optional,{any_of,[{ref,<<"ThreadId">>},{exact,null}]}},
                 overrides =>
                     {optional,
                         {any_of,
                             [{ref,<<"NewConversationParams">>},
                              {exact,null}]}}}}}}}.
