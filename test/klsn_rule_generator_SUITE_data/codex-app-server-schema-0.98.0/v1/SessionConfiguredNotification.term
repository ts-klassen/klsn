#{to_json =>
   {with_defs,
    {#{<<"McpStartupStatus">> =>
        {any_of,
         [{struct,#{state => {required,{enum,[<<"starting">>]}}}},
          {struct,#{state => {required,{enum,[<<"ready">>]}}}},
          {struct,
           #{error => {required,binstr},
             state => {required,{enum,[<<"failed">>]}}}},
          {struct,#{state => {required,{enum,[<<"cancelled">>]}}}}]},
       <<"Duration">> =>
        {struct,#{nanos => {required,integer},secs => {required,integer}}},
       <<"AskForApproval">> =>
        {any_of,
         [{enum,[<<"untrusted">>]},
          {enum,[<<"on-failure">>]},
          {enum,[<<"on-request">>]},
          {enum,[<<"never">>]}]},
       <<"McpInvocation">> =>
        {struct,
         #{arguments => {optional,term},
           server => {required,binstr},
           tool => {required,binstr}}},
       <<"ReasoningEffort">> =>
        {enum,
         [<<"none">>,<<"minimal">>,<<"low">>,<<"medium">>,<<"high">>,
          <<"xhigh">>]},
       <<"ResponseItem">> =>
        {any_of,
         [{struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"message">>]}},
             content => {required,{list,{ref,<<"ContentItem">>}}},
             end_turn => {optional,{any_of,[boolean,{exact,null}]}},
             phase =>
              {optional,{any_of,[{ref,<<"MessagePhase">>},{exact,null}]}},
             role => {required,binstr}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"reasoning">>]}},
             content =>
              {optional,
               {default,
                {null,
                 {any_of,
                  [{list,{ref,<<"ReasoningItemContent">>}},{exact,null}]}}}},
             summary =>
              {required,{list,{ref,<<"ReasoningItemReasoningSummary">>}}},
             encrypted_content => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             status => {required,{ref,<<"LocalShellStatus">>}},
             type => {required,{enum,[<<"local_shell_call">>]}},
             action => {required,{ref,<<"LocalShellAction">>}},
             call_id => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             name => {required,binstr},
             type => {required,{enum,[<<"function_call">>]}},
             arguments => {required,binstr},
             call_id => {required,binstr}}},
          {struct,
           #{output => {required,{ref,<<"FunctionCallOutputPayload">>}},
             type => {required,{enum,[<<"function_call_output">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             input => {required,binstr},
             name => {required,binstr},
             status => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"custom_tool_call">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{output => {required,binstr},
             type => {required,{enum,[<<"custom_tool_call_output">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             status => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"web_search_call">>]}},
             action =>
              {optional,{any_of,[{ref,<<"WebSearchAction">>},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"ghost_snapshot">>]}},
             ghost_commit => {required,{ref,<<"GhostCommit">>}}}},
          {struct,
           #{type => {required,{enum,[<<"compaction">>]}},
             encrypted_content => {required,binstr}}},
          {struct,#{type => {required,{enum,[<<"other">>]}}}}]},
       <<"MessagePhase">> => {enum,[<<"commentary">>,<<"final_answer">>]},
       <<"RemoteSkillSummary">> =>
        {struct,
         #{id => {required,binstr},
           name => {required,binstr},
           description => {required,binstr}}},
       <<"ParsedCommand">> =>
        {any_of,
         [{struct,
           #{name => {required,binstr},
             type => {required,{enum,[<<"read">>]}},
             path => {required,binstr},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"list_files">>]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"search">>]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr},
             query => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"unknown">>]}},
             cmd => {required,binstr}}}]},
       <<"FunctionCallOutputPayload">> =>
        {struct,
         #{success => {optional,{any_of,[boolean,{exact,null}]}},
           body => {required,{ref,<<"FunctionCallOutputBody">>}}}},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[<<"danger-full-access">>]}}}},
          {struct,#{type => {required,{enum,[<<"read-only">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"external-sandbox">>]}},
             network_access =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"workspace-write">>]}},
             network_access => {optional,{default,{false,boolean}}},
             exclude_slash_tmp => {optional,{default,{false,boolean}}},
             exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
             writable_roots =>
              {optional,{list,{ref,<<"AbsolutePathBuf">>}}}}}]},
       <<"TextElement">> =>
        {struct,
         #{placeholder => {optional,{any_of,[binstr,{exact,null}]}},
           byte_range => {required,{all_of,[{ref,<<"ByteRange">>}]}}}},
       <<"ExecOutputStream">> => {enum,[<<"stdout">>,<<"stderr">>]},
       <<"AgentMessageContent">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"Text">>]}},
             text => {required,binstr}}}]},
       <<"UserInput">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"text">>]}},
             text => {required,binstr},
             text_elements =>
              {optional,{default,{[],{list,{ref,<<"TextElement">>}}}}}}},
          {struct,
           #{type => {required,{enum,[<<"image">>]}},
             image_url => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"local_image">>]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[<<"skill">>]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[<<"mention">>]}},
             path => {required,binstr}}}]},
       <<"RequestUserInputQuestionOption">> =>
        {struct,
         #{label => {required,binstr},description => {required,binstr}}},
       <<"AbsolutePathBuf">> => binstr,
       <<"FunctionCallOutputContentItem">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"input_text">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"input_image">>]}},
             image_url => {required,binstr}}}]},
       <<"PlanType">> =>
        {enum,
         [<<"free">>,<<"go">>,<<"plus">>,<<"pro">>,<<"team">>,<<"business">>,
          <<"enterprise">>,<<"edu">>,<<"unknown">>]},
       <<"SkillDependencies">> =>
        {struct,#{tools => {required,{list,{ref,<<"SkillToolDependency">>}}}}},
       <<"SkillInterface">> =>
        {struct,
         #{short_description => {optional,{any_of,[binstr,{exact,null}]}},
           brand_color => {optional,{any_of,[binstr,{exact,null}]}},
           default_prompt => {optional,{any_of,[binstr,{exact,null}]}},
           display_name => {optional,{any_of,[binstr,{exact,null}]}},
           icon_large => {optional,{any_of,[binstr,{exact,null}]}},
           icon_small => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"Resource">> =>
        {struct,
         #{name => {required,binstr},
           size => {optional,{any_of,[integer,{exact,null}]}},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           title => {optional,{any_of,[binstr,{exact,null}]}},
           uri => {required,binstr},
           '_meta' => {optional,term},
           annotations => {optional,term},
           icons => {optional,{any_of,[{list,term},{exact,null}]}},
           mimeType => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ThreadId">> => binstr,
       <<"SkillsListEntry">> =>
        {struct,
         #{cwd => {required,binstr},
           errors => {required,{list,{ref,<<"SkillErrorInfo">>}}},
           skills => {required,{list,{ref,<<"SkillMetadata">>}}}}},
       <<"RateLimitSnapshot">> =>
        {struct,
         #{primary =>
            {optional,{any_of,[{ref,<<"RateLimitWindow">>},{exact,null}]}},
           credits =>
            {optional,{any_of,[{ref,<<"CreditsSnapshot">>},{exact,null}]}},
           secondary =>
            {optional,{any_of,[{ref,<<"RateLimitWindow">>},{exact,null}]}},
           plan_type =>
            {optional,{any_of,[{ref,<<"PlanType">>},{exact,null}]}}}},
       <<"ReviewTarget">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[<<"uncommittedChanges">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"baseBranch">>]}},
             branch => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"commit">>]}},
             title => {optional,{any_of,[binstr,{exact,null}]}},
             sha => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"custom">>]}},
             instructions => {required,binstr}}}]},
       <<"FunctionCallOutputBody">> =>
        {any_of,[binstr,{list,{ref,<<"FunctionCallOutputContentItem">>}}]},
       <<"RateLimitWindow">> =>
        {struct,
         #{resets_at => {optional,{any_of,[integer,{exact,null}]}},
           used_percent => {required,number},
           window_minutes => {optional,{any_of,[integer,{exact,null}]}}}},
       <<"McpAuthStatus">> =>
        {enum,
         [<<"unsupported">>,<<"not_logged_in">>,<<"bearer_token">>,
          <<"o_auth">>]},
       <<"SkillMetadata">> =>
        {struct,
         #{enabled => {required,boolean},
           name => {required,binstr},
           scope => {required,{ref,<<"SkillScope">>}},
           path => {required,binstr},
           interface =>
            {optional,{any_of,[{ref,<<"SkillInterface">>},{exact,null}]}},
           description => {required,binstr},
           dependencies =>
            {optional,{any_of,[{ref,<<"SkillDependencies">>},{exact,null}]}},
           short_description => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"CallToolResult">> =>
        {struct,
         #{content => {required,{list,term}},
           structuredContent => {optional,term},
           '_meta' => {optional,term},
           isError => {optional,{any_of,[boolean,{exact,null}]}}}},
       <<"LocalShellStatus">> =>
        {enum,[<<"completed">>,<<"in_progress">>,<<"incomplete">>]},
       <<"GhostCommit">> =>
        {struct,
         #{id => {required,binstr},
           parent => {optional,{any_of,[binstr,{exact,null}]}},
           preexisting_untracked_dirs => {required,{list,binstr}},
           preexisting_untracked_files => {required,{list,binstr}}}},
       <<"ModeKind">> => {enum,[<<"plan">>,<<"default">>]},
       <<"ReasoningItemReasoningSummary">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"summary_text">>]}},
             text => {required,binstr}}}]},
       <<"ReasoningItemContent">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"reasoning_text">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"text">>]}},
             text => {required,binstr}}}]},
       <<"Result_of_CallToolResult_or_String">> =>
        {any_of,
         [{struct,#{'Ok' => {required,{ref,<<"CallToolResult">>}}}},
          {struct,#{'Err' => {required,binstr}}}]},
       <<"Tool">> =>
        {struct,
         #{name => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           title => {optional,{any_of,[binstr,{exact,null}]}},
           outputSchema => {optional,term},
           inputSchema => {required,term},
           '_meta' => {optional,term},
           annotations => {optional,term},
           icons => {optional,{any_of,[{list,term},{exact,null}]}}}},
       <<"ResourceTemplate">> =>
        {struct,
         #{name => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           title => {optional,{any_of,[binstr,{exact,null}]}},
           annotations => {optional,term},
           mimeType => {optional,{any_of,[binstr,{exact,null}]}},
           uriTemplate => {required,binstr}}},
       <<"TurnItem">> =>
        {any_of,
         [{struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"UserMessage">>]}},
             content => {required,{list,{ref,<<"UserInput">>}}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"AgentMessage">>]}},
             content => {required,{list,{ref,<<"AgentMessageContent">>}}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"Plan">>]}},
             text => {required,binstr}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"Reasoning">>]}},
             raw_content => {optional,{default,{[],{list,binstr}}}},
             summary_text => {required,{list,binstr}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"WebSearch">>]}},
             query => {required,binstr},
             action => {required,{ref,<<"WebSearchAction">>}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"ContextCompaction">>]}}}}]},
       <<"PlanItemArg">> =>
        {struct,
         #{status => {required,{ref,<<"StepStatus">>}},
           step => {required,binstr}}},
       <<"HistoryEntry">> =>
        {struct,
         #{text => {required,binstr},
           conversation_id => {required,binstr},
           ts => {required,integer}}},
       <<"ExecCommandSource">> =>
        {enum,
         [<<"agent">>,<<"user_shell">>,<<"unified_exec_startup">>,
          <<"unified_exec_interaction">>]},
       <<"RequestUserInputQuestion">> =>
        {struct,
         #{id => {required,binstr},
           header => {required,binstr},
           options =>
            {optional,
             {any_of,
              [{list,{ref,<<"RequestUserInputQuestionOption">>}},
               {exact,null}]}},
           isOther => {optional,{default,{false,boolean}}},
           isSecret => {optional,{default,{false,boolean}}},
           question => {required,binstr}}},
       <<"TurnAbortReason">> =>
        {enum,[<<"interrupted">>,<<"replaced">>,<<"review_ended">>]},
       <<"WebSearchAction">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"search">>]}},
             query => {optional,{any_of,[binstr,{exact,null}]}},
             queries => {optional,{any_of,[{list,binstr},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"open_page">>]}},
             url => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"find_in_page">>]}},
             pattern => {optional,{any_of,[binstr,{exact,null}]}},
             url => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,#{type => {required,{enum,[<<"other">>]}}}}]},
       <<"CreditsSnapshot">> =>
        {struct,
         #{unlimited => {required,boolean},
           balance => {optional,{any_of,[binstr,{exact,null}]}},
           has_credits => {required,boolean}}},
       <<"StepStatus">> =>
        {enum,[<<"pending">>,<<"in_progress">>,<<"completed">>]},
       <<"SkillErrorInfo">> =>
        {struct,#{message => {required,binstr},path => {required,binstr}}},
       <<"TokenUsageInfo">> =>
        {struct,
         #{model_context_window => {optional,{any_of,[integer,{exact,null}]}},
           last_token_usage => {required,{ref,<<"TokenUsage">>}},
           total_token_usage => {required,{ref,<<"TokenUsage">>}}}},
       <<"FileChange">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"add">>]}},
             content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"delete">>]}},
             content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"update">>]}},
             move_path => {optional,{any_of,[binstr,{exact,null}]}},
             unified_diff => {required,binstr}}}]},
       <<"CustomPrompt">> =>
        {struct,
         #{name => {required,binstr},
           path => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           content => {required,binstr},
           argument_hint => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ByteRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"CodexErrorInfo">> =>
        {any_of,
         [{enum,
           [<<"context_window_exceeded">>,<<"usage_limit_exceeded">>,
            <<"internal_server_error">>,<<"unauthorized">>,<<"bad_request">>,
            <<"sandbox_error">>,<<"thread_rollback_failed">>,<<"other">>]},
          {struct,
           #{model_cap =>
              {required,
               {struct,
                #{model => {required,binstr},
                  reset_after_seconds =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{http_connection_failed =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{response_stream_connection_failed =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{response_stream_disconnected =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{response_too_many_failed_attempts =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}}]},
       <<"NetworkAccess">> => {enum,[<<"restricted">>,<<"enabled">>]},
       <<"SkillScope">> =>
        {enum,[<<"user">>,<<"repo">>,<<"system">>,<<"admin">>]},
       <<"ContentItem">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"input_text">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"input_image">>]}},
             image_url => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"output_text">>]}},
             text => {required,binstr}}}]},
       <<"RequestId">> => {any_of,[binstr,integer]},
       <<"SkillToolDependency">> =>
        {struct,
         #{command => {optional,{any_of,[binstr,{exact,null}]}},
           type => {required,binstr},
           value => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           url => {optional,{any_of,[binstr,{exact,null}]}},
           transport => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"EventMsg">> =>
        {any_of,
         [{struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"error">>]}},
             codex_error_info =>
              {optional,
               {default,
                {null,{any_of,[{ref,<<"CodexErrorInfo">>},{exact,null}]}}}}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"warning">>]}}}},
          {struct,#{type => {required,{enum,[<<"context_compacted">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"thread_rolled_back">>]}},
             num_turns => {required,integer}}},
          {struct,
           #{type => {required,{enum,[<<"task_started">>]}},
             model_context_window =>
              {optional,{any_of,[integer,{exact,null}]}},
             collaboration_mode_kind =>
              {optional,
               {default,{<<"default">>,{all_of,[{ref,<<"ModeKind">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"task_complete">>]}},
             last_agent_message => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{info =>
              {optional,{any_of,[{ref,<<"TokenUsageInfo">>},{exact,null}]}},
             type => {required,{enum,[<<"token_count">>]}},
             rate_limits =>
              {optional,
               {any_of,[{ref,<<"RateLimitSnapshot">>},{exact,null}]}}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"agent_message">>]}}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"user_message">>]}},
             text_elements =>
              {optional,{default,{[],{list,{ref,<<"TextElement">>}}}}},
             images => {optional,{any_of,[{list,binstr},{exact,null}]}},
             local_images => {optional,{default,{[],{list,binstr}}}}}},
          {struct,
           #{type => {required,{enum,[<<"agent_message_delta">>]}},
             delta => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning_delta">>]}},
             delta => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning_raw_content">>]}},
             text => {required,binstr}}},
          {struct,
           #{type =>
              {required,{enum,[<<"agent_reasoning_raw_content_delta">>]}},
             delta => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning_section_break">>]}},
             item_id => {optional,{default,{<<>>,binstr}}},
             summary_index => {optional,{default,{0,integer}}}}},
          {struct,
           #{type => {required,{enum,[<<"session_configured">>]}},
             cwd => {required,binstr},
             model => {required,binstr},
             reasoning_effort =>
              {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
             approval_policy =>
              {required,{all_of,[{ref,<<"AskForApproval">>}]}},
             forked_from_id =>
              {optional,{any_of,[{ref,<<"ThreadId">>},{exact,null}]}},
             history_entry_count => {required,integer},
             history_log_id => {required,integer},
             initial_messages =>
              {optional,{any_of,[{list,{ref,<<"EventMsg">>}},{exact,null}]}},
             model_provider_id => {required,binstr},
             rollout_path => {optional,{any_of,[binstr,{exact,null}]}},
             sandbox_policy => {required,{all_of,[{ref,<<"SandboxPolicy">>}]}},
             session_id => {required,{ref,<<"ThreadId">>}},
             thread_name => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"thread_name_updated">>]}},
             thread_name => {optional,{any_of,[binstr,{exact,null}]}},
             thread_id => {required,{ref,<<"ThreadId">>}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"McpStartupStatus">>}]}},
             type => {required,{enum,[<<"mcp_startup_update">>]}},
             server => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_startup_complete">>]}},
             cancelled => {required,{list,binstr}},
             failed => {required,{list,{ref,<<"McpStartupFailure">>}}},
             ready => {required,{list,binstr}}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_tool_call_begin">>]}},
             call_id => {required,binstr},
             invocation => {required,{ref,<<"McpInvocation">>}}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_tool_call_end">>]}},
             result =>
              {required,
               {all_of,[{ref,<<"Result_of_CallToolResult_or_String">>}]}},
             call_id => {required,binstr},
             invocation => {required,{ref,<<"McpInvocation">>}},
             duration => {required,{ref,<<"Duration">>}}}},
          {struct,
           #{type => {required,{enum,[<<"web_search_begin">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"web_search_end">>]}},
             query => {required,binstr},
             action => {required,{ref,<<"WebSearchAction">>}},
             call_id => {required,binstr}}},
          {struct,
           #{command => {required,{list,binstr}},
             type => {required,{enum,[<<"exec_command_begin">>]}},
             source =>
              {optional,
               {default,
                {<<"agent">>,{all_of,[{ref,<<"ExecCommandSource">>}]}}}},
             cwd => {required,binstr},
             call_id => {required,binstr},
             interaction_input => {optional,{any_of,[binstr,{exact,null}]}},
             parsed_cmd => {required,{list,{ref,<<"ParsedCommand">>}}},
             process_id => {optional,{any_of,[binstr,{exact,null}]}},
             turn_id => {required,binstr}}},
          {struct,
           #{stream => {required,{all_of,[{ref,<<"ExecOutputStream">>}]}},
             type => {required,{enum,[<<"exec_command_output_delta">>]}},
             chunk => {required,binstr},
             call_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"terminal_interaction">>]}},
             stdin => {required,binstr},
             call_id => {required,binstr},
             process_id => {required,binstr}}},
          {struct,
           #{command => {required,{list,binstr}},
             type => {required,{enum,[<<"exec_command_end">>]}},
             stdout => {required,binstr},
             stderr => {required,binstr},
             source =>
              {optional,
               {default,
                {<<"agent">>,{all_of,[{ref,<<"ExecCommandSource">>}]}}}},
             cwd => {required,binstr},
             call_id => {required,binstr},
             duration => {required,{all_of,[{ref,<<"Duration">>}]}},
             interaction_input => {optional,{any_of,[binstr,{exact,null}]}},
             parsed_cmd => {required,{list,{ref,<<"ParsedCommand">>}}},
             process_id => {optional,{any_of,[binstr,{exact,null}]}},
             turn_id => {required,binstr},
             aggregated_output => {optional,{default,{<<>>,binstr}}},
             exit_code => {required,integer},
             formatted_output => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"view_image_tool_call">>]}},
             path => {required,binstr},
             call_id => {required,binstr}}},
          {struct,
           #{command => {required,{list,binstr}},
             reason => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"exec_approval_request">>]}},
             cwd => {required,binstr},
             proposed_execpolicy_amendment =>
              {optional,{any_of,[{list,binstr},{exact,null}]}},
             call_id => {required,binstr},
             parsed_cmd => {required,{list,{ref,<<"ParsedCommand">>}}},
             turn_id => {optional,{default,{<<>>,binstr}}}}},
          {struct,
           #{type => {required,{enum,[<<"request_user_input">>]}},
             questions =>
              {required,{list,{ref,<<"RequestUserInputQuestion">>}}},
             call_id => {required,binstr},
             turn_id => {optional,{default,{<<>>,binstr}}}}},
          {struct,
           #{type => {required,{enum,[<<"dynamic_tool_call_request">>]}},
             arguments => {required,term},
             callId => {required,binstr},
             tool => {required,binstr},
             turnId => {required,binstr}}},
          {struct,
           #{id => {required,{ref,<<"RequestId">>}},
             message => {required,binstr},
             type => {required,{enum,[<<"elicitation_request">>]}},
             server_name => {required,binstr}}},
          {struct,
           #{reason => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"apply_patch_approval_request">>]}},
             call_id => {required,binstr},
             changes => {required,{map,{binstr,{ref,<<"FileChange">>}}}},
             turn_id => {optional,{default,{<<>>,binstr}}},
             grant_root => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"deprecation_notice">>]}},
             details => {optional,{any_of,[binstr,{exact,null}]}},
             summary => {required,binstr}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"background_event">>]}}}},
          {struct,
           #{message => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"undo_started">>]}}}},
          {struct,
           #{message => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"undo_completed">>]}},
             success => {required,boolean}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"stream_error">>]}},
             codex_error_info =>
              {optional,
               {default,
                {null,{any_of,[{ref,<<"CodexErrorInfo">>},{exact,null}]}}}},
             additional_details =>
              {optional,{default,{null,{any_of,[binstr,{exact,null}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"patch_apply_begin">>]}},
             call_id => {required,binstr},
             changes => {required,{map,{binstr,{ref,<<"FileChange">>}}}},
             turn_id => {optional,{default,{<<>>,binstr}}},
             auto_approved => {required,boolean}}},
          {struct,
           #{type => {required,{enum,[<<"patch_apply_end">>]}},
             stdout => {required,binstr},
             stderr => {required,binstr},
             success => {required,boolean},
             call_id => {required,binstr},
             changes =>
              {optional,{default,{#{},{map,{binstr,{ref,<<"FileChange">>}}}}}},
             turn_id => {optional,{default,{<<>>,binstr}}}}},
          {struct,
           #{type => {required,{enum,[<<"turn_diff">>]}},
             unified_diff => {required,binstr}}},
          {struct,
           #{offset => {required,integer},
             type => {required,{enum,[<<"get_history_entry_response">>]}},
             entry =>
              {optional,{any_of,[{ref,<<"HistoryEntry">>},{exact,null}]}},
             log_id => {required,integer}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_list_tools_response">>]}},
             tools => {required,{map,{binstr,{ref,<<"Tool">>}}}},
             resources =>
              {required,{map,{binstr,{list,{ref,<<"Resource">>}}}}},
             auth_statuses =>
              {required,{map,{binstr,{ref,<<"McpAuthStatus">>}}}},
             resource_templates =>
              {required,{map,{binstr,{list,{ref,<<"ResourceTemplate">>}}}}}}},
          {struct,
           #{type => {required,{enum,[<<"list_custom_prompts_response">>]}},
             custom_prompts => {required,{list,{ref,<<"CustomPrompt">>}}}}},
          {struct,
           #{type => {required,{enum,[<<"list_skills_response">>]}},
             skills => {required,{list,{ref,<<"SkillsListEntry">>}}}}},
          {struct,
           #{type => {required,{enum,[<<"list_remote_skills_response">>]}},
             skills => {required,{list,{ref,<<"RemoteSkillSummary">>}}}}},
          {struct,
           #{id => {required,binstr},
             name => {required,binstr},
             type => {required,{enum,[<<"remote_skill_downloaded">>]}},
             path => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"skills_update_available">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"plan_update">>]}},
             explanation =>
              {optional,{default,{null,{any_of,[binstr,{exact,null}]}}}},
             plan => {required,{list,{ref,<<"PlanItemArg">>}}}}},
          {struct,
           #{reason => {required,{ref,<<"TurnAbortReason">>}},
             type => {required,{enum,[<<"turn_aborted">>]}}}},
          {struct,#{type => {required,{enum,[<<"shutdown_complete">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"entered_review_mode">>]}},
             target => {required,{ref,<<"ReviewTarget">>}},
             user_facing_hint => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"exited_review_mode">>]}},
             review_output =>
              {optional,
               {any_of,[{ref,<<"ReviewOutputEvent">>},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"raw_response_item">>]}},
             item => {required,{ref,<<"ResponseItem">>}}}},
          {struct,
           #{type => {required,{enum,[<<"item_started">>]}},
             item => {required,{ref,<<"TurnItem">>}},
             thread_id => {required,{ref,<<"ThreadId">>}},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"item_completed">>]}},
             item => {required,{ref,<<"TurnItem">>}},
             thread_id => {required,{ref,<<"ThreadId">>}},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_message_content_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             thread_id => {required,binstr},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"plan_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             thread_id => {required,binstr},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"reasoning_content_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             summary_index => {optional,{default,{0,integer}}},
             thread_id => {required,binstr},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"reasoning_raw_content_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             thread_id => {required,binstr},
             turn_id => {required,binstr},
             content_index => {optional,{default,{0,integer}}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_agent_spawn_begin">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"AgentStatus">>}]}},
             type => {required,{enum,[<<"collab_agent_spawn_end">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             new_thread_id =>
              {optional,{any_of,[{ref,<<"ThreadId">>},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_agent_interaction_begin">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"AgentStatus">>}]}},
             type => {required,{enum,[<<"collab_agent_interaction_end">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_waiting_begin">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_ids => {required,{list,{ref,<<"ThreadId">>}}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_waiting_end">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             statuses => {required,{map,{binstr,{ref,<<"AgentStatus">>}}}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_close_begin">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"AgentStatus">>}]}},
             type => {required,{enum,[<<"collab_close_end">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}}]},
       <<"AgentStatus">> =>
        {any_of,
         [{enum,[<<"pending_init">>]},
          {enum,[<<"running">>]},
          {struct,#{completed => {required,{any_of,[binstr,{exact,null}]}}}},
          {struct,#{errored => {required,binstr}}},
          {enum,[<<"shutdown">>]},
          {enum,[<<"not_found">>]}]},
       <<"ReviewCodeLocation">> =>
        {struct,
         #{absolute_file_path => {required,binstr},
           line_range => {required,{ref,<<"ReviewLineRange">>}}}},
       <<"TokenUsage">> =>
        {struct,
         #{cached_input_tokens => {required,integer},
           input_tokens => {required,integer},
           output_tokens => {required,integer},
           reasoning_output_tokens => {required,integer},
           total_tokens => {required,integer}}},
       <<"McpStartupFailure">> =>
        {struct,#{error => {required,binstr},server => {required,binstr}}},
       <<"ReviewOutputEvent">> =>
        {struct,
         #{findings => {required,{list,{ref,<<"ReviewFinding">>}}},
           overall_confidence_score => {required,number},
           overall_correctness => {required,binstr},
           overall_explanation => {required,binstr}}},
       <<"ReviewLineRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"ReviewFinding">> =>
        {struct,
         #{priority => {required,integer},
           title => {required,binstr},
           body => {required,binstr},
           code_location => {required,{ref,<<"ReviewCodeLocation">>}},
           confidence_score => {required,number}}},
       <<"LocalShellAction">> =>
        {any_of,
         [{struct,
           #{command => {required,{list,binstr}},
             env => {optional,{any_of,[{map,{binstr,term}},{exact,null}]}},
             type => {required,{enum,[<<"exec">>]}},
             user => {optional,{any_of,[binstr,{exact,null}]}},
             timeout_ms => {optional,{any_of,[integer,{exact,null}]}},
             working_directory =>
              {optional,{any_of,[binstr,{exact,null}]}}}}]}},
     {struct,
      #{rolloutPath => {required,binstr},
        model => {required,binstr},
        reasoningEffort =>
         {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
        historyEntryCount => {required,integer},
        historyLogId => {required,integer},
        initialMessages =>
         {optional,{any_of,[{list,{ref,<<"EventMsg">>}},{exact,null}]}},
        sessionId => {required,{ref,<<"ThreadId">>}}}}}},
  from_json =>
   {with_defs,
    {#{<<"McpStartupStatus">> =>
        {any_of,
         [{struct,#{state => {required,{enum,[<<"starting">>]}}}},
          {struct,#{state => {required,{enum,[<<"ready">>]}}}},
          {struct,
           #{error => {required,binstr},
             state => {required,{enum,[<<"failed">>]}}}},
          {struct,#{state => {required,{enum,[<<"cancelled">>]}}}}]},
       <<"Duration">> =>
        {struct,#{nanos => {required,integer},secs => {required,integer}}},
       <<"AskForApproval">> =>
        {any_of,
         [{enum,[<<"untrusted">>]},
          {enum,[<<"on-failure">>]},
          {enum,[<<"on-request">>]},
          {enum,[<<"never">>]}]},
       <<"McpInvocation">> =>
        {struct,
         #{arguments => {optional,term},
           server => {required,binstr},
           tool => {required,binstr}}},
       <<"ReasoningEffort">> =>
        {enum,
         [<<"none">>,<<"minimal">>,<<"low">>,<<"medium">>,<<"high">>,
          <<"xhigh">>]},
       <<"ResponseItem">> =>
        {any_of,
         [{struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"message">>]}},
             content => {required,{list,{ref,<<"ContentItem">>}}},
             end_turn => {optional,{any_of,[boolean,{exact,null}]}},
             phase =>
              {optional,{any_of,[{ref,<<"MessagePhase">>},{exact,null}]}},
             role => {required,binstr}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"reasoning">>]}},
             content =>
              {optional,
               {default,
                {null,
                 {any_of,
                  [{list,{ref,<<"ReasoningItemContent">>}},{exact,null}]}}}},
             summary =>
              {required,{list,{ref,<<"ReasoningItemReasoningSummary">>}}},
             encrypted_content => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             status => {required,{ref,<<"LocalShellStatus">>}},
             type => {required,{enum,[<<"local_shell_call">>]}},
             action => {required,{ref,<<"LocalShellAction">>}},
             call_id => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             name => {required,binstr},
             type => {required,{enum,[<<"function_call">>]}},
             arguments => {required,binstr},
             call_id => {required,binstr}}},
          {struct,
           #{output => {required,{ref,<<"FunctionCallOutputPayload">>}},
             type => {required,{enum,[<<"function_call_output">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             input => {required,binstr},
             name => {required,binstr},
             status => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"custom_tool_call">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{output => {required,binstr},
             type => {required,{enum,[<<"custom_tool_call_output">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{id => {optional,{any_of,[binstr,{exact,null}]}},
             status => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"web_search_call">>]}},
             action =>
              {optional,{any_of,[{ref,<<"WebSearchAction">>},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"ghost_snapshot">>]}},
             ghost_commit => {required,{ref,<<"GhostCommit">>}}}},
          {struct,
           #{type => {required,{enum,[<<"compaction">>]}},
             encrypted_content => {required,binstr}}},
          {struct,#{type => {required,{enum,[<<"other">>]}}}}]},
       <<"MessagePhase">> => {enum,[<<"commentary">>,<<"final_answer">>]},
       <<"RemoteSkillSummary">> =>
        {struct,
         #{id => {required,binstr},
           name => {required,binstr},
           description => {required,binstr}}},
       <<"ParsedCommand">> =>
        {any_of,
         [{struct,
           #{name => {required,binstr},
             type => {required,{enum,[<<"read">>]}},
             path => {required,binstr},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"list_files">>]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"search">>]}},
             path => {optional,{any_of,[binstr,{exact,null}]}},
             cmd => {required,binstr},
             query => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"unknown">>]}},
             cmd => {required,binstr}}}]},
       <<"FunctionCallOutputPayload">> =>
        {struct,
         #{success => {optional,{any_of,[boolean,{exact,null}]}},
           body => {required,{ref,<<"FunctionCallOutputBody">>}}}},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[<<"danger-full-access">>]}}}},
          {struct,#{type => {required,{enum,[<<"read-only">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"external-sandbox">>]}},
             network_access =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"workspace-write">>]}},
             network_access => {optional,{default,{false,boolean}}},
             exclude_slash_tmp => {optional,{default,{false,boolean}}},
             exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
             writable_roots =>
              {optional,{list,{ref,<<"AbsolutePathBuf">>}}}}}]},
       <<"TextElement">> =>
        {struct,
         #{placeholder => {optional,{any_of,[binstr,{exact,null}]}},
           byte_range => {required,{all_of,[{ref,<<"ByteRange">>}]}}}},
       <<"ExecOutputStream">> => {enum,[<<"stdout">>,<<"stderr">>]},
       <<"AgentMessageContent">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"Text">>]}},
             text => {required,binstr}}}]},
       <<"UserInput">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"text">>]}},
             text => {required,binstr},
             text_elements =>
              {optional,{default,{[],{list,{ref,<<"TextElement">>}}}}}}},
          {struct,
           #{type => {required,{enum,[<<"image">>]}},
             image_url => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"local_image">>]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[<<"skill">>]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[<<"mention">>]}},
             path => {required,binstr}}}]},
       <<"RequestUserInputQuestionOption">> =>
        {struct,
         #{label => {required,binstr},description => {required,binstr}}},
       <<"AbsolutePathBuf">> => binstr,
       <<"FunctionCallOutputContentItem">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"input_text">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"input_image">>]}},
             image_url => {required,binstr}}}]},
       <<"PlanType">> =>
        {enum,
         [<<"free">>,<<"go">>,<<"plus">>,<<"pro">>,<<"team">>,<<"business">>,
          <<"enterprise">>,<<"edu">>,<<"unknown">>]},
       <<"SkillDependencies">> =>
        {struct,#{tools => {required,{list,{ref,<<"SkillToolDependency">>}}}}},
       <<"SkillInterface">> =>
        {struct,
         #{short_description => {optional,{any_of,[binstr,{exact,null}]}},
           brand_color => {optional,{any_of,[binstr,{exact,null}]}},
           default_prompt => {optional,{any_of,[binstr,{exact,null}]}},
           display_name => {optional,{any_of,[binstr,{exact,null}]}},
           icon_large => {optional,{any_of,[binstr,{exact,null}]}},
           icon_small => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"Resource">> =>
        {struct,
         #{name => {required,binstr},
           size => {optional,{any_of,[integer,{exact,null}]}},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           title => {optional,{any_of,[binstr,{exact,null}]}},
           uri => {required,binstr},
           '_meta' => {optional,term},
           annotations => {optional,term},
           icons => {optional,{any_of,[{list,term},{exact,null}]}},
           mimeType => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ThreadId">> => binstr,
       <<"SkillsListEntry">> =>
        {struct,
         #{cwd => {required,binstr},
           errors => {required,{list,{ref,<<"SkillErrorInfo">>}}},
           skills => {required,{list,{ref,<<"SkillMetadata">>}}}}},
       <<"RateLimitSnapshot">> =>
        {struct,
         #{primary =>
            {optional,{any_of,[{ref,<<"RateLimitWindow">>},{exact,null}]}},
           credits =>
            {optional,{any_of,[{ref,<<"CreditsSnapshot">>},{exact,null}]}},
           secondary =>
            {optional,{any_of,[{ref,<<"RateLimitWindow">>},{exact,null}]}},
           plan_type =>
            {optional,{any_of,[{ref,<<"PlanType">>},{exact,null}]}}}},
       <<"ReviewTarget">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[<<"uncommittedChanges">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"baseBranch">>]}},
             branch => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"commit">>]}},
             title => {optional,{any_of,[binstr,{exact,null}]}},
             sha => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"custom">>]}},
             instructions => {required,binstr}}}]},
       <<"FunctionCallOutputBody">> =>
        {any_of,[binstr,{list,{ref,<<"FunctionCallOutputContentItem">>}}]},
       <<"RateLimitWindow">> =>
        {struct,
         #{resets_at => {optional,{any_of,[integer,{exact,null}]}},
           used_percent => {required,number},
           window_minutes => {optional,{any_of,[integer,{exact,null}]}}}},
       <<"McpAuthStatus">> =>
        {enum,
         [<<"unsupported">>,<<"not_logged_in">>,<<"bearer_token">>,
          <<"o_auth">>]},
       <<"SkillMetadata">> =>
        {struct,
         #{enabled => {required,boolean},
           name => {required,binstr},
           scope => {required,{ref,<<"SkillScope">>}},
           path => {required,binstr},
           interface =>
            {optional,{any_of,[{ref,<<"SkillInterface">>},{exact,null}]}},
           description => {required,binstr},
           dependencies =>
            {optional,{any_of,[{ref,<<"SkillDependencies">>},{exact,null}]}},
           short_description => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"CallToolResult">> =>
        {struct,
         #{content => {required,{list,term}},
           structuredContent => {optional,term},
           '_meta' => {optional,term},
           isError => {optional,{any_of,[boolean,{exact,null}]}}}},
       <<"LocalShellStatus">> =>
        {enum,[<<"completed">>,<<"in_progress">>,<<"incomplete">>]},
       <<"GhostCommit">> =>
        {struct,
         #{id => {required,binstr},
           parent => {optional,{any_of,[binstr,{exact,null}]}},
           preexisting_untracked_dirs => {required,{list,binstr}},
           preexisting_untracked_files => {required,{list,binstr}}}},
       <<"ModeKind">> => {enum,[<<"plan">>,<<"default">>]},
       <<"ReasoningItemReasoningSummary">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"summary_text">>]}},
             text => {required,binstr}}}]},
       <<"ReasoningItemContent">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"reasoning_text">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"text">>]}},
             text => {required,binstr}}}]},
       <<"Result_of_CallToolResult_or_String">> =>
        {any_of,
         [{struct,#{'Ok' => {required,{ref,<<"CallToolResult">>}}}},
          {struct,#{'Err' => {required,binstr}}}]},
       <<"Tool">> =>
        {struct,
         #{name => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           title => {optional,{any_of,[binstr,{exact,null}]}},
           outputSchema => {optional,term},
           inputSchema => {required,term},
           '_meta' => {optional,term},
           annotations => {optional,term},
           icons => {optional,{any_of,[{list,term},{exact,null}]}}}},
       <<"ResourceTemplate">> =>
        {struct,
         #{name => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           title => {optional,{any_of,[binstr,{exact,null}]}},
           annotations => {optional,term},
           mimeType => {optional,{any_of,[binstr,{exact,null}]}},
           uriTemplate => {required,binstr}}},
       <<"TurnItem">> =>
        {any_of,
         [{struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"UserMessage">>]}},
             content => {required,{list,{ref,<<"UserInput">>}}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"AgentMessage">>]}},
             content => {required,{list,{ref,<<"AgentMessageContent">>}}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"Plan">>]}},
             text => {required,binstr}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"Reasoning">>]}},
             raw_content => {optional,{default,{[],{list,binstr}}}},
             summary_text => {required,{list,binstr}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"WebSearch">>]}},
             query => {required,binstr},
             action => {required,{ref,<<"WebSearchAction">>}}}},
          {struct,
           #{id => {required,binstr},
             type => {required,{enum,[<<"ContextCompaction">>]}}}}]},
       <<"PlanItemArg">> =>
        {struct,
         #{status => {required,{ref,<<"StepStatus">>}},
           step => {required,binstr}}},
       <<"HistoryEntry">> =>
        {struct,
         #{text => {required,binstr},
           conversation_id => {required,binstr},
           ts => {required,integer}}},
       <<"ExecCommandSource">> =>
        {enum,
         [<<"agent">>,<<"user_shell">>,<<"unified_exec_startup">>,
          <<"unified_exec_interaction">>]},
       <<"RequestUserInputQuestion">> =>
        {struct,
         #{id => {required,binstr},
           header => {required,binstr},
           options =>
            {optional,
             {any_of,
              [{list,{ref,<<"RequestUserInputQuestionOption">>}},
               {exact,null}]}},
           isOther => {optional,{default,{false,boolean}}},
           isSecret => {optional,{default,{false,boolean}}},
           question => {required,binstr}}},
       <<"TurnAbortReason">> =>
        {enum,[<<"interrupted">>,<<"replaced">>,<<"review_ended">>]},
       <<"WebSearchAction">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"search">>]}},
             query => {optional,{any_of,[binstr,{exact,null}]}},
             queries => {optional,{any_of,[{list,binstr},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"open_page">>]}},
             url => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"find_in_page">>]}},
             pattern => {optional,{any_of,[binstr,{exact,null}]}},
             url => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,#{type => {required,{enum,[<<"other">>]}}}}]},
       <<"CreditsSnapshot">> =>
        {struct,
         #{unlimited => {required,boolean},
           balance => {optional,{any_of,[binstr,{exact,null}]}},
           has_credits => {required,boolean}}},
       <<"StepStatus">> =>
        {enum,[<<"pending">>,<<"in_progress">>,<<"completed">>]},
       <<"SkillErrorInfo">> =>
        {struct,#{message => {required,binstr},path => {required,binstr}}},
       <<"TokenUsageInfo">> =>
        {struct,
         #{model_context_window => {optional,{any_of,[integer,{exact,null}]}},
           last_token_usage => {required,{ref,<<"TokenUsage">>}},
           total_token_usage => {required,{ref,<<"TokenUsage">>}}}},
       <<"FileChange">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"add">>]}},
             content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"delete">>]}},
             content => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"update">>]}},
             move_path => {optional,{any_of,[binstr,{exact,null}]}},
             unified_diff => {required,binstr}}}]},
       <<"CustomPrompt">> =>
        {struct,
         #{name => {required,binstr},
           path => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           content => {required,binstr},
           argument_hint => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ByteRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"CodexErrorInfo">> =>
        {any_of,
         [{enum,
           [<<"context_window_exceeded">>,<<"usage_limit_exceeded">>,
            <<"internal_server_error">>,<<"unauthorized">>,<<"bad_request">>,
            <<"sandbox_error">>,<<"thread_rollback_failed">>,<<"other">>]},
          {struct,
           #{model_cap =>
              {required,
               {struct,
                #{model => {required,binstr},
                  reset_after_seconds =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{http_connection_failed =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{response_stream_connection_failed =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{response_stream_disconnected =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}},
          {struct,
           #{response_too_many_failed_attempts =>
              {required,
               {struct,
                #{http_status_code =>
                   {optional,{any_of,[integer,{exact,null}]}}}}}}}]},
       <<"NetworkAccess">> => {enum,[<<"restricted">>,<<"enabled">>]},
       <<"SkillScope">> =>
        {enum,[<<"user">>,<<"repo">>,<<"system">>,<<"admin">>]},
       <<"ContentItem">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"input_text">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"input_image">>]}},
             image_url => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"output_text">>]}},
             text => {required,binstr}}}]},
       <<"RequestId">> => {any_of,[binstr,integer]},
       <<"SkillToolDependency">> =>
        {struct,
         #{command => {optional,{any_of,[binstr,{exact,null}]}},
           type => {required,binstr},
           value => {required,binstr},
           description => {optional,{any_of,[binstr,{exact,null}]}},
           url => {optional,{any_of,[binstr,{exact,null}]}},
           transport => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"EventMsg">> =>
        {any_of,
         [{struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"error">>]}},
             codex_error_info =>
              {optional,
               {default,
                {null,{any_of,[{ref,<<"CodexErrorInfo">>},{exact,null}]}}}}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"warning">>]}}}},
          {struct,#{type => {required,{enum,[<<"context_compacted">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"thread_rolled_back">>]}},
             num_turns => {required,integer}}},
          {struct,
           #{type => {required,{enum,[<<"task_started">>]}},
             model_context_window =>
              {optional,{any_of,[integer,{exact,null}]}},
             collaboration_mode_kind =>
              {optional,
               {default,{<<"default">>,{all_of,[{ref,<<"ModeKind">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"task_complete">>]}},
             last_agent_message => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{info =>
              {optional,{any_of,[{ref,<<"TokenUsageInfo">>},{exact,null}]}},
             type => {required,{enum,[<<"token_count">>]}},
             rate_limits =>
              {optional,
               {any_of,[{ref,<<"RateLimitSnapshot">>},{exact,null}]}}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"agent_message">>]}}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"user_message">>]}},
             text_elements =>
              {optional,{default,{[],{list,{ref,<<"TextElement">>}}}}},
             images => {optional,{any_of,[{list,binstr},{exact,null}]}},
             local_images => {optional,{default,{[],{list,binstr}}}}}},
          {struct,
           #{type => {required,{enum,[<<"agent_message_delta">>]}},
             delta => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning">>]}},
             text => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning_delta">>]}},
             delta => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning_raw_content">>]}},
             text => {required,binstr}}},
          {struct,
           #{type =>
              {required,{enum,[<<"agent_reasoning_raw_content_delta">>]}},
             delta => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_reasoning_section_break">>]}},
             item_id => {optional,{default,{<<>>,binstr}}},
             summary_index => {optional,{default,{0,integer}}}}},
          {struct,
           #{type => {required,{enum,[<<"session_configured">>]}},
             cwd => {required,binstr},
             model => {required,binstr},
             reasoning_effort =>
              {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
             approval_policy =>
              {required,{all_of,[{ref,<<"AskForApproval">>}]}},
             forked_from_id =>
              {optional,{any_of,[{ref,<<"ThreadId">>},{exact,null}]}},
             history_entry_count => {required,integer},
             history_log_id => {required,integer},
             initial_messages =>
              {optional,{any_of,[{list,{ref,<<"EventMsg">>}},{exact,null}]}},
             model_provider_id => {required,binstr},
             rollout_path => {optional,{any_of,[binstr,{exact,null}]}},
             sandbox_policy => {required,{all_of,[{ref,<<"SandboxPolicy">>}]}},
             session_id => {required,{ref,<<"ThreadId">>}},
             thread_name => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"thread_name_updated">>]}},
             thread_name => {optional,{any_of,[binstr,{exact,null}]}},
             thread_id => {required,{ref,<<"ThreadId">>}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"McpStartupStatus">>}]}},
             type => {required,{enum,[<<"mcp_startup_update">>]}},
             server => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_startup_complete">>]}},
             cancelled => {required,{list,binstr}},
             failed => {required,{list,{ref,<<"McpStartupFailure">>}}},
             ready => {required,{list,binstr}}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_tool_call_begin">>]}},
             call_id => {required,binstr},
             invocation => {required,{ref,<<"McpInvocation">>}}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_tool_call_end">>]}},
             result =>
              {required,
               {all_of,[{ref,<<"Result_of_CallToolResult_or_String">>}]}},
             call_id => {required,binstr},
             invocation => {required,{ref,<<"McpInvocation">>}},
             duration => {required,{ref,<<"Duration">>}}}},
          {struct,
           #{type => {required,{enum,[<<"web_search_begin">>]}},
             call_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"web_search_end">>]}},
             query => {required,binstr},
             action => {required,{ref,<<"WebSearchAction">>}},
             call_id => {required,binstr}}},
          {struct,
           #{command => {required,{list,binstr}},
             type => {required,{enum,[<<"exec_command_begin">>]}},
             source =>
              {optional,
               {default,
                {<<"agent">>,{all_of,[{ref,<<"ExecCommandSource">>}]}}}},
             cwd => {required,binstr},
             call_id => {required,binstr},
             interaction_input => {optional,{any_of,[binstr,{exact,null}]}},
             parsed_cmd => {required,{list,{ref,<<"ParsedCommand">>}}},
             process_id => {optional,{any_of,[binstr,{exact,null}]}},
             turn_id => {required,binstr}}},
          {struct,
           #{stream => {required,{all_of,[{ref,<<"ExecOutputStream">>}]}},
             type => {required,{enum,[<<"exec_command_output_delta">>]}},
             chunk => {required,binstr},
             call_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"terminal_interaction">>]}},
             stdin => {required,binstr},
             call_id => {required,binstr},
             process_id => {required,binstr}}},
          {struct,
           #{command => {required,{list,binstr}},
             type => {required,{enum,[<<"exec_command_end">>]}},
             stdout => {required,binstr},
             stderr => {required,binstr},
             source =>
              {optional,
               {default,
                {<<"agent">>,{all_of,[{ref,<<"ExecCommandSource">>}]}}}},
             cwd => {required,binstr},
             call_id => {required,binstr},
             duration => {required,{all_of,[{ref,<<"Duration">>}]}},
             interaction_input => {optional,{any_of,[binstr,{exact,null}]}},
             parsed_cmd => {required,{list,{ref,<<"ParsedCommand">>}}},
             process_id => {optional,{any_of,[binstr,{exact,null}]}},
             turn_id => {required,binstr},
             aggregated_output => {optional,{default,{<<>>,binstr}}},
             exit_code => {required,integer},
             formatted_output => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"view_image_tool_call">>]}},
             path => {required,binstr},
             call_id => {required,binstr}}},
          {struct,
           #{command => {required,{list,binstr}},
             reason => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"exec_approval_request">>]}},
             cwd => {required,binstr},
             proposed_execpolicy_amendment =>
              {optional,{any_of,[{list,binstr},{exact,null}]}},
             call_id => {required,binstr},
             parsed_cmd => {required,{list,{ref,<<"ParsedCommand">>}}},
             turn_id => {optional,{default,{<<>>,binstr}}}}},
          {struct,
           #{type => {required,{enum,[<<"request_user_input">>]}},
             questions =>
              {required,{list,{ref,<<"RequestUserInputQuestion">>}}},
             call_id => {required,binstr},
             turn_id => {optional,{default,{<<>>,binstr}}}}},
          {struct,
           #{type => {required,{enum,[<<"dynamic_tool_call_request">>]}},
             arguments => {required,term},
             callId => {required,binstr},
             tool => {required,binstr},
             turnId => {required,binstr}}},
          {struct,
           #{id => {required,{ref,<<"RequestId">>}},
             message => {required,binstr},
             type => {required,{enum,[<<"elicitation_request">>]}},
             server_name => {required,binstr}}},
          {struct,
           #{reason => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"apply_patch_approval_request">>]}},
             call_id => {required,binstr},
             changes => {required,{map,{binstr,{ref,<<"FileChange">>}}}},
             turn_id => {optional,{default,{<<>>,binstr}}},
             grant_root => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"deprecation_notice">>]}},
             details => {optional,{any_of,[binstr,{exact,null}]}},
             summary => {required,binstr}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"background_event">>]}}}},
          {struct,
           #{message => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"undo_started">>]}}}},
          {struct,
           #{message => {optional,{any_of,[binstr,{exact,null}]}},
             type => {required,{enum,[<<"undo_completed">>]}},
             success => {required,boolean}}},
          {struct,
           #{message => {required,binstr},
             type => {required,{enum,[<<"stream_error">>]}},
             codex_error_info =>
              {optional,
               {default,
                {null,{any_of,[{ref,<<"CodexErrorInfo">>},{exact,null}]}}}},
             additional_details =>
              {optional,{default,{null,{any_of,[binstr,{exact,null}]}}}}}},
          {struct,
           #{type => {required,{enum,[<<"patch_apply_begin">>]}},
             call_id => {required,binstr},
             changes => {required,{map,{binstr,{ref,<<"FileChange">>}}}},
             turn_id => {optional,{default,{<<>>,binstr}}},
             auto_approved => {required,boolean}}},
          {struct,
           #{type => {required,{enum,[<<"patch_apply_end">>]}},
             stdout => {required,binstr},
             stderr => {required,binstr},
             success => {required,boolean},
             call_id => {required,binstr},
             changes =>
              {optional,{default,{#{},{map,{binstr,{ref,<<"FileChange">>}}}}}},
             turn_id => {optional,{default,{<<>>,binstr}}}}},
          {struct,
           #{type => {required,{enum,[<<"turn_diff">>]}},
             unified_diff => {required,binstr}}},
          {struct,
           #{offset => {required,integer},
             type => {required,{enum,[<<"get_history_entry_response">>]}},
             entry =>
              {optional,{any_of,[{ref,<<"HistoryEntry">>},{exact,null}]}},
             log_id => {required,integer}}},
          {struct,
           #{type => {required,{enum,[<<"mcp_list_tools_response">>]}},
             tools => {required,{map,{binstr,{ref,<<"Tool">>}}}},
             resources =>
              {required,{map,{binstr,{list,{ref,<<"Resource">>}}}}},
             auth_statuses =>
              {required,{map,{binstr,{ref,<<"McpAuthStatus">>}}}},
             resource_templates =>
              {required,{map,{binstr,{list,{ref,<<"ResourceTemplate">>}}}}}}},
          {struct,
           #{type => {required,{enum,[<<"list_custom_prompts_response">>]}},
             custom_prompts => {required,{list,{ref,<<"CustomPrompt">>}}}}},
          {struct,
           #{type => {required,{enum,[<<"list_skills_response">>]}},
             skills => {required,{list,{ref,<<"SkillsListEntry">>}}}}},
          {struct,
           #{type => {required,{enum,[<<"list_remote_skills_response">>]}},
             skills => {required,{list,{ref,<<"RemoteSkillSummary">>}}}}},
          {struct,
           #{id => {required,binstr},
             name => {required,binstr},
             type => {required,{enum,[<<"remote_skill_downloaded">>]}},
             path => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"skills_update_available">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"plan_update">>]}},
             explanation =>
              {optional,{default,{null,{any_of,[binstr,{exact,null}]}}}},
             plan => {required,{list,{ref,<<"PlanItemArg">>}}}}},
          {struct,
           #{reason => {required,{ref,<<"TurnAbortReason">>}},
             type => {required,{enum,[<<"turn_aborted">>]}}}},
          {struct,#{type => {required,{enum,[<<"shutdown_complete">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"entered_review_mode">>]}},
             target => {required,{ref,<<"ReviewTarget">>}},
             user_facing_hint => {optional,{any_of,[binstr,{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"exited_review_mode">>]}},
             review_output =>
              {optional,
               {any_of,[{ref,<<"ReviewOutputEvent">>},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"raw_response_item">>]}},
             item => {required,{ref,<<"ResponseItem">>}}}},
          {struct,
           #{type => {required,{enum,[<<"item_started">>]}},
             item => {required,{ref,<<"TurnItem">>}},
             thread_id => {required,{ref,<<"ThreadId">>}},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"item_completed">>]}},
             item => {required,{ref,<<"TurnItem">>}},
             thread_id => {required,{ref,<<"ThreadId">>}},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"agent_message_content_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             thread_id => {required,binstr},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"plan_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             thread_id => {required,binstr},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"reasoning_content_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             summary_index => {optional,{default,{0,integer}}},
             thread_id => {required,binstr},
             turn_id => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"reasoning_raw_content_delta">>]}},
             delta => {required,binstr},
             item_id => {required,binstr},
             thread_id => {required,binstr},
             turn_id => {required,binstr},
             content_index => {optional,{default,{0,integer}}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_agent_spawn_begin">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"AgentStatus">>}]}},
             type => {required,{enum,[<<"collab_agent_spawn_end">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             new_thread_id =>
              {optional,{any_of,[{ref,<<"ThreadId">>},{exact,null}]}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_agent_interaction_begin">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"AgentStatus">>}]}},
             type => {required,{enum,[<<"collab_agent_interaction_end">>]}},
             prompt => {required,binstr},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_waiting_begin">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_ids => {required,{list,{ref,<<"ThreadId">>}}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_waiting_end">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             statuses => {required,{map,{binstr,{ref,<<"AgentStatus">>}}}}}},
          {struct,
           #{type => {required,{enum,[<<"collab_close_begin">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}},
          {struct,
           #{status => {required,{all_of,[{ref,<<"AgentStatus">>}]}},
             type => {required,{enum,[<<"collab_close_end">>]}},
             call_id => {required,binstr},
             sender_thread_id => {required,{all_of,[{ref,<<"ThreadId">>}]}},
             receiver_thread_id =>
              {required,{all_of,[{ref,<<"ThreadId">>}]}}}}]},
       <<"AgentStatus">> =>
        {any_of,
         [{enum,[<<"pending_init">>]},
          {enum,[<<"running">>]},
          {struct,#{completed => {required,{any_of,[binstr,{exact,null}]}}}},
          {struct,#{errored => {required,binstr}}},
          {enum,[<<"shutdown">>]},
          {enum,[<<"not_found">>]}]},
       <<"ReviewCodeLocation">> =>
        {struct,
         #{absolute_file_path => {required,binstr},
           line_range => {required,{ref,<<"ReviewLineRange">>}}}},
       <<"TokenUsage">> =>
        {struct,
         #{cached_input_tokens => {required,integer},
           input_tokens => {required,integer},
           output_tokens => {required,integer},
           reasoning_output_tokens => {required,integer},
           total_tokens => {required,integer}}},
       <<"McpStartupFailure">> =>
        {struct,#{error => {required,binstr},server => {required,binstr}}},
       <<"ReviewOutputEvent">> =>
        {struct,
         #{findings => {required,{list,{ref,<<"ReviewFinding">>}}},
           overall_confidence_score => {required,number},
           overall_correctness => {required,binstr},
           overall_explanation => {required,binstr}}},
       <<"ReviewLineRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"ReviewFinding">> =>
        {struct,
         #{priority => {required,integer},
           title => {required,binstr},
           body => {required,binstr},
           code_location => {required,{ref,<<"ReviewCodeLocation">>}},
           confidence_score => {required,number}}},
       <<"LocalShellAction">> =>
        {any_of,
         [{struct,
           #{command => {required,{list,binstr}},
             env => {optional,{any_of,[{map,{binstr,term}},{exact,null}]}},
             type => {required,{enum,[<<"exec">>]}},
             user => {optional,{any_of,[binstr,{exact,null}]}},
             timeout_ms => {optional,{any_of,[integer,{exact,null}]}},
             working_directory =>
              {optional,{any_of,[binstr,{exact,null}]}}}}]}},
     {struct,
      #{rolloutPath => {required,binstr},
        model => {required,binstr},
        reasoningEffort =>
         {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
        historyEntryCount => {required,integer},
        historyLogId => {required,integer},
        initialMessages =>
         {optional,{any_of,[{list,{ref,<<"EventMsg">>}},{exact,null}]}},
        sessionId => {required,{ref,<<"ThreadId">>}}}}}}}.
