#{to_json =>
      {with_defs,
          {#{<<"AskForApproval">> =>
                 {enum,[untrusted,'on-failure','on-request',never]},
             <<"DynamicToolSpec">> =>
                 {struct,
                     #{name => {required,binstr},
                       description => {required,binstr},
                       inputSchema => {required,term}}},
             <<"Personality">> => {enum,[none,friendly,pragmatic]},
             <<"SandboxMode">> =>
                 {enum,['read-only','workspace-write','danger-full-access']}},
           {struct,
               #{config =>
                     {optional,{any_of,[{map,{binstr,term}},{exact,null}]}},
                 cwd => {optional,{any_of,[binstr,{exact,null}]}},
                 model => {optional,{any_of,[binstr,{exact,null}]}},
                 approvalPolicy =>
                     {optional,
                         {any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
                 personality =>
                     {optional,
                         {any_of,[{ref,<<"Personality">>},{exact,null}]}},
                 experimentalRawEvents => {optional,{default,{false,boolean}}},
                 baseInstructions => {optional,{any_of,[binstr,{exact,null}]}},
                 developerInstructions =>
                     {optional,{any_of,[binstr,{exact,null}]}},
                 modelProvider => {optional,{any_of,[binstr,{exact,null}]}},
                 sandbox =>
                     {optional,
                         {any_of,[{ref,<<"SandboxMode">>},{exact,null}]}},
                 ephemeral => {optional,{any_of,[boolean,{exact,null}]}}}}}},
  from_json =>
      {with_defs,
          {#{<<"AskForApproval">> =>
                 {enum,[untrusted,'on-failure','on-request',never]},
             <<"DynamicToolSpec">> =>
                 {struct,
                     #{name => {required,binstr},
                       description => {required,binstr},
                       inputSchema => {required,term}}},
             <<"Personality">> => {enum,[none,friendly,pragmatic]},
             <<"SandboxMode">> =>
                 {enum,['read-only','workspace-write','danger-full-access']}},
           {struct,
               #{config =>
                     {optional,{any_of,[{map,{binstr,term}},{exact,null}]}},
                 cwd => {optional,{any_of,[binstr,{exact,null}]}},
                 model => {optional,{any_of,[binstr,{exact,null}]}},
                 approvalPolicy =>
                     {optional,
                         {any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
                 personality =>
                     {optional,
                         {any_of,[{ref,<<"Personality">>},{exact,null}]}},
                 experimentalRawEvents => {optional,{default,{false,boolean}}},
                 baseInstructions => {optional,{any_of,[binstr,{exact,null}]}},
                 developerInstructions =>
                     {optional,{any_of,[binstr,{exact,null}]}},
                 modelProvider => {optional,{any_of,[binstr,{exact,null}]}},
                 sandbox =>
                     {optional,
                         {any_of,[{ref,<<"SandboxMode">>},{exact,null}]}},
                 ephemeral => {optional,{any_of,[boolean,{exact,null}]}}}}}}}.
