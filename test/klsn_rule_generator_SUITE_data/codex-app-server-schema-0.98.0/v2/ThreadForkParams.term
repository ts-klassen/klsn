#{to_json =>
      {with_defs,
          {#{<<"AskForApproval">> =>
                 {enum,[untrusted,'on-failure','on-request',never]},
             <<"SandboxMode">> =>
                 {enum,['read-only','workspace-write','danger-full-access']}},
           {struct,
               #{config =>
                     {optional,{any_of,[{map,{binstr,term}},{exact,null}]}},
                 path => {optional,{any_of,[binstr,{exact,null}]}},
                 cwd => {optional,{any_of,[binstr,{exact,null}]}},
                 threadId => {required,binstr},
                 model => {optional,{any_of,[binstr,{exact,null}]}},
                 approvalPolicy =>
                     {optional,
                         {any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
                 baseInstructions => {optional,{any_of,[binstr,{exact,null}]}},
                 developerInstructions =>
                     {optional,{any_of,[binstr,{exact,null}]}},
                 modelProvider => {optional,{any_of,[binstr,{exact,null}]}},
                 sandbox =>
                     {optional,
                         {any_of,[{ref,<<"SandboxMode">>},{exact,null}]}}}}}},
  from_json =>
      {with_defs,
          {#{<<"AskForApproval">> =>
                 {enum,[untrusted,'on-failure','on-request',never]},
             <<"SandboxMode">> =>
                 {enum,['read-only','workspace-write','danger-full-access']}},
           {struct,
               #{config =>
                     {optional,{any_of,[{map,{binstr,term}},{exact,null}]}},
                 path => {optional,{any_of,[binstr,{exact,null}]}},
                 cwd => {optional,{any_of,[binstr,{exact,null}]}},
                 threadId => {required,binstr},
                 model => {optional,{any_of,[binstr,{exact,null}]}},
                 approvalPolicy =>
                     {optional,
                         {any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
                 baseInstructions => {optional,{any_of,[binstr,{exact,null}]}},
                 developerInstructions =>
                     {optional,{any_of,[binstr,{exact,null}]}},
                 modelProvider => {optional,{any_of,[binstr,{exact,null}]}},
                 sandbox =>
                     {optional,
                         {any_of,[{ref,<<"SandboxMode">>},{exact,null}]}}}}}}}.
