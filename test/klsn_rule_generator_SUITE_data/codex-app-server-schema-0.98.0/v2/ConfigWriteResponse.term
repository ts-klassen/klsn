#{to_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"ConfigLayerMetadata">> =>
        {struct,
         #{name => {required,{ref,<<"ConfigLayerSource">>}},
           version => {required,binstr}}},
       <<"ConfigLayerSource">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"mdm">>]}},
             domain => {required,binstr},
             key => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"system">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"user">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"project">>]}},
             dotCodexFolder => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,#{type => {required,{enum,[<<"sessionFlags">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"legacyManagedConfigTomlFromFile">>]}},
             file => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,
           #{type =>
              {required,{enum,[<<"legacyManagedConfigTomlFromMdm">>]}}}}]},
       <<"OverriddenMetadata">> =>
        {struct,
         #{message => {required,binstr},
           effectiveValue => {required,term},
           overridingLayer => {required,{ref,<<"ConfigLayerMetadata">>}}}},
       <<"WriteStatus">> => {enum,[<<"ok">>,<<"okOverridden">>]}},
     {struct,
      #{status => {required,{ref,<<"WriteStatus">>}},
        version => {required,binstr},
        filePath => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}},
        overriddenMetadata =>
         {optional,{any_of,[{ref,<<"OverriddenMetadata">>},{exact,null}]}}}}}},
  from_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"ConfigLayerMetadata">> =>
        {struct,
         #{name => {required,{ref,<<"ConfigLayerSource">>}},
           version => {required,binstr}}},
       <<"ConfigLayerSource">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"mdm">>]}},
             domain => {required,binstr},
             key => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"system">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"user">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"project">>]}},
             dotCodexFolder => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,#{type => {required,{enum,[<<"sessionFlags">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"legacyManagedConfigTomlFromFile">>]}},
             file => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,
           #{type =>
              {required,{enum,[<<"legacyManagedConfigTomlFromMdm">>]}}}}]},
       <<"OverriddenMetadata">> =>
        {struct,
         #{message => {required,binstr},
           effectiveValue => {required,term},
           overridingLayer => {required,{ref,<<"ConfigLayerMetadata">>}}}},
       <<"WriteStatus">> => {enum,[<<"ok">>,<<"okOverridden">>]}},
     {struct,
      #{status => {required,{ref,<<"WriteStatus">>}},
        version => {required,binstr},
        filePath => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}},
        overriddenMetadata =>
         {optional,
          {any_of,[{ref,<<"OverriddenMetadata">>},{exact,null}]}}}}}}}.
