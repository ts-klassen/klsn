#{to_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"AnalyticsConfig">> =>
        {struct,#{enabled => {optional,{any_of,[boolean,{exact,null}]}}}},
       <<"AskForApproval">> =>
        {enum,[<<"untrusted">>,<<"on-failure">>,<<"on-request">>,<<"never">>]},
       <<"Config">> =>
        {struct,
         #{profile => {optional,{any_of,[binstr,{exact,null}]}},
           instructions => {optional,{any_of,[binstr,{exact,null}]}},
           tools => {optional,{any_of,[{ref,<<"ToolsV2">>},{exact,null}]}},
           model => {optional,{any_of,[binstr,{exact,null}]}},
           profiles =>
            {optional,{default,{#{},{map,{binstr,{ref,<<"ProfileV2">>}}}}}},
           developer_instructions => {optional,{any_of,[binstr,{exact,null}]}},
           analytics =>
            {optional,{any_of,[{ref,<<"AnalyticsConfig">>},{exact,null}]}},
           approval_policy =>
            {optional,{any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
           compact_prompt => {optional,{any_of,[binstr,{exact,null}]}},
           forced_chatgpt_workspace_id =>
            {optional,{any_of,[binstr,{exact,null}]}},
           forced_login_method =>
            {optional,{any_of,[{ref,<<"ForcedLoginMethod">>},{exact,null}]}},
           model_auto_compact_token_limit =>
            {optional,{any_of,[integer,{exact,null}]}},
           model_context_window => {optional,{any_of,[integer,{exact,null}]}},
           model_provider => {optional,{any_of,[binstr,{exact,null}]}},
           model_reasoning_effort =>
            {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
           model_reasoning_summary =>
            {optional,{any_of,[{ref,<<"ReasoningSummary">>},{exact,null}]}},
           model_verbosity =>
            {optional,{any_of,[{ref,<<"Verbosity">>},{exact,null}]}},
           review_model => {optional,{any_of,[binstr,{exact,null}]}},
           sandbox_mode =>
            {optional,{any_of,[{ref,<<"SandboxMode">>},{exact,null}]}},
           sandbox_workspace_write =>
            {optional,
             {any_of,[{ref,<<"SandboxWorkspaceWrite">>},{exact,null}]}},
           web_search =>
            {optional,{any_of,[{ref,<<"WebSearchMode">>},{exact,null}]}}}},
       <<"ConfigLayer">> =>
        {struct,
         #{name => {required,{ref,<<"ConfigLayerSource">>}},
           version => {required,binstr},
           config => {required,term},
           disabledReason => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ConfigLayerMetadata">> =>
        {struct,
         #{name => {required,{ref,<<"ConfigLayerSource">>}},
           version => {required,binstr}}},
       <<"ConfigLayerSource">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"mdm">>]}},
             domain => {required,binstr},
             key => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"system">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"user">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"project">>]}},
             dotCodexFolder => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,#{type => {required,{enum,[<<"sessionFlags">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"legacyManagedConfigTomlFromFile">>]}},
             file => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,
           #{type =>
              {required,{enum,[<<"legacyManagedConfigTomlFromMdm">>]}}}}]},
       <<"ForcedLoginMethod">> => {enum,[<<"chatgpt">>,<<"api">>]},
       <<"ProfileV2">> =>
        {struct,
         #{model => {optional,{any_of,[binstr,{exact,null}]}},
           approval_policy =>
            {optional,{any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
           model_provider => {optional,{any_of,[binstr,{exact,null}]}},
           model_reasoning_effort =>
            {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
           model_reasoning_summary =>
            {optional,{any_of,[{ref,<<"ReasoningSummary">>},{exact,null}]}},
           model_verbosity =>
            {optional,{any_of,[{ref,<<"Verbosity">>},{exact,null}]}},
           web_search =>
            {optional,{any_of,[{ref,<<"WebSearchMode">>},{exact,null}]}},
           chatgpt_base_url => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ReasoningEffort">> =>
        {enum,
         [<<"none">>,<<"minimal">>,<<"low">>,<<"medium">>,<<"high">>,
          <<"xhigh">>]},
       <<"ReasoningSummary">> =>
        {any_of,
         [{enum,[<<"auto">>,<<"concise">>,<<"detailed">>]},
          {enum,[<<"none">>]}]},
       <<"SandboxMode">> =>
        {enum,
         [<<"read-only">>,<<"workspace-write">>,<<"danger-full-access">>]},
       <<"SandboxWorkspaceWrite">> =>
        {struct,
         #{network_access => {optional,{default,{false,boolean}}},
           exclude_slash_tmp => {optional,{default,{false,boolean}}},
           exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
           writable_roots => {optional,{default,{[],{list,binstr}}}}}},
       <<"ToolsV2">> =>
        {struct,
         #{web_search => {optional,{any_of,[boolean,{exact,null}]}},
           view_image => {optional,{any_of,[boolean,{exact,null}]}}}},
       <<"Verbosity">> => {enum,[<<"low">>,<<"medium">>,<<"high">>]},
       <<"WebSearchMode">> => {enum,[<<"disabled">>,<<"cached">>,<<"live">>]}},
     {struct,
      #{config => {required,{ref,<<"Config">>}},
        layers =>
         {optional,{any_of,[{list,{ref,<<"ConfigLayer">>}},{exact,null}]}},
        origins =>
         {required,{map,{binstr,{ref,<<"ConfigLayerMetadata">>}}}}}}}},
  from_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"AnalyticsConfig">> =>
        {struct,#{enabled => {optional,{any_of,[boolean,{exact,null}]}}}},
       <<"AskForApproval">> =>
        {enum,[<<"untrusted">>,<<"on-failure">>,<<"on-request">>,<<"never">>]},
       <<"Config">> =>
        {struct,
         #{profile => {optional,{any_of,[binstr,{exact,null}]}},
           instructions => {optional,{any_of,[binstr,{exact,null}]}},
           tools => {optional,{any_of,[{ref,<<"ToolsV2">>},{exact,null}]}},
           model => {optional,{any_of,[binstr,{exact,null}]}},
           profiles =>
            {optional,{default,{#{},{map,{binstr,{ref,<<"ProfileV2">>}}}}}},
           developer_instructions => {optional,{any_of,[binstr,{exact,null}]}},
           analytics =>
            {optional,{any_of,[{ref,<<"AnalyticsConfig">>},{exact,null}]}},
           approval_policy =>
            {optional,{any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
           compact_prompt => {optional,{any_of,[binstr,{exact,null}]}},
           forced_chatgpt_workspace_id =>
            {optional,{any_of,[binstr,{exact,null}]}},
           forced_login_method =>
            {optional,{any_of,[{ref,<<"ForcedLoginMethod">>},{exact,null}]}},
           model_auto_compact_token_limit =>
            {optional,{any_of,[integer,{exact,null}]}},
           model_context_window => {optional,{any_of,[integer,{exact,null}]}},
           model_provider => {optional,{any_of,[binstr,{exact,null}]}},
           model_reasoning_effort =>
            {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
           model_reasoning_summary =>
            {optional,{any_of,[{ref,<<"ReasoningSummary">>},{exact,null}]}},
           model_verbosity =>
            {optional,{any_of,[{ref,<<"Verbosity">>},{exact,null}]}},
           review_model => {optional,{any_of,[binstr,{exact,null}]}},
           sandbox_mode =>
            {optional,{any_of,[{ref,<<"SandboxMode">>},{exact,null}]}},
           sandbox_workspace_write =>
            {optional,
             {any_of,[{ref,<<"SandboxWorkspaceWrite">>},{exact,null}]}},
           web_search =>
            {optional,{any_of,[{ref,<<"WebSearchMode">>},{exact,null}]}}}},
       <<"ConfigLayer">> =>
        {struct,
         #{name => {required,{ref,<<"ConfigLayerSource">>}},
           version => {required,binstr},
           config => {required,term},
           disabledReason => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ConfigLayerMetadata">> =>
        {struct,
         #{name => {required,{ref,<<"ConfigLayerSource">>}},
           version => {required,binstr}}},
       <<"ConfigLayerSource">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[<<"mdm">>]}},
             domain => {required,binstr},
             key => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[<<"system">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"user">>]}},
             file => {required,{all_of,[{ref,<<"AbsolutePathBuf">>}]}}}},
          {struct,
           #{type => {required,{enum,[<<"project">>]}},
             dotCodexFolder => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,#{type => {required,{enum,[<<"sessionFlags">>]}}}},
          {struct,
           #{type => {required,{enum,[<<"legacyManagedConfigTomlFromFile">>]}},
             file => {required,{ref,<<"AbsolutePathBuf">>}}}},
          {struct,
           #{type =>
              {required,{enum,[<<"legacyManagedConfigTomlFromMdm">>]}}}}]},
       <<"ForcedLoginMethod">> => {enum,[<<"chatgpt">>,<<"api">>]},
       <<"ProfileV2">> =>
        {struct,
         #{model => {optional,{any_of,[binstr,{exact,null}]}},
           approval_policy =>
            {optional,{any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
           model_provider => {optional,{any_of,[binstr,{exact,null}]}},
           model_reasoning_effort =>
            {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
           model_reasoning_summary =>
            {optional,{any_of,[{ref,<<"ReasoningSummary">>},{exact,null}]}},
           model_verbosity =>
            {optional,{any_of,[{ref,<<"Verbosity">>},{exact,null}]}},
           web_search =>
            {optional,{any_of,[{ref,<<"WebSearchMode">>},{exact,null}]}},
           chatgpt_base_url => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"ReasoningEffort">> =>
        {enum,
         [<<"none">>,<<"minimal">>,<<"low">>,<<"medium">>,<<"high">>,
          <<"xhigh">>]},
       <<"ReasoningSummary">> =>
        {any_of,
         [{enum,[<<"auto">>,<<"concise">>,<<"detailed">>]},
          {enum,[<<"none">>]}]},
       <<"SandboxMode">> =>
        {enum,
         [<<"read-only">>,<<"workspace-write">>,<<"danger-full-access">>]},
       <<"SandboxWorkspaceWrite">> =>
        {struct,
         #{network_access => {optional,{default,{false,boolean}}},
           exclude_slash_tmp => {optional,{default,{false,boolean}}},
           exclude_tmpdir_env_var => {optional,{default,{false,boolean}}},
           writable_roots => {optional,{default,{[],{list,binstr}}}}}},
       <<"ToolsV2">> =>
        {struct,
         #{web_search => {optional,{any_of,[boolean,{exact,null}]}},
           view_image => {optional,{any_of,[boolean,{exact,null}]}}}},
       <<"Verbosity">> => {enum,[<<"low">>,<<"medium">>,<<"high">>]},
       <<"WebSearchMode">> => {enum,[<<"disabled">>,<<"cached">>,<<"live">>]}},
     {struct,
      #{config => {required,{ref,<<"Config">>}},
        layers =>
         {optional,{any_of,[{list,{ref,<<"ConfigLayer">>}},{exact,null}]}},
        origins =>
         {required,{map,{binstr,{ref,<<"ConfigLayerMetadata">>}}}}}}}}}.
