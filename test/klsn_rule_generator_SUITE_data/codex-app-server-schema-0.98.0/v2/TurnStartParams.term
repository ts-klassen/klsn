#{to_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"AskForApproval">> =>
        {enum,[untrusted,'on-failure','on-request',never]},
       <<"ByteRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"CollaborationMode">> =>
        {struct,
         #{mode => {required,{ref,<<"ModeKind">>}},
           settings => {required,{ref,<<"Settings">>}}}},
       <<"ModeKind">> => {enum,[plan,default]},
       <<"NetworkAccess">> => {enum,[restricted,enabled]},
       <<"Personality">> => {enum,[none,friendly,pragmatic]},
       <<"ReasoningEffort">> => {enum,[none,minimal,low,medium,high,xhigh]},
       <<"ReasoningSummary">> =>
        {any_of,[{enum,[auto,concise,detailed]},{enum,[none]}]},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[dangerFullAccess]}}}},
          {struct,#{type => {required,{enum,[readOnly]}}}},
          {struct,
           #{type => {required,{enum,[externalSandbox]}},
             networkAccess =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[workspaceWrite]}},
             networkAccess => {optional,{default,{false,boolean}}},
             excludeSlashTmp => {optional,{default,{false,boolean}}},
             excludeTmpdirEnvVar => {optional,{default,{false,boolean}}},
             writableRoots =>
              {optional,{default,{[],{list,{ref,<<"AbsolutePathBuf">>}}}}}}}]},
       <<"Settings">> =>
        {struct,
         #{model => {required,binstr},
           developer_instructions => {optional,{any_of,[binstr,{exact,null}]}},
           reasoning_effort =>
            {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}}}},
       <<"TextElement">> =>
        {struct,
         #{byteRange => {required,{all_of,[{ref,<<"ByteRange">>}]}},
           placeholder => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"UserInput">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[text]}},
             text => {required,binstr},
             text_elements =>
              {optional,{default,{[],{list,{ref,<<"TextElement">>}}}}}}},
          {struct,
           #{type => {required,{enum,[image]}},url => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[localImage]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[skill]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[mention]}},
             path => {required,binstr}}}]}},
     {struct,
      #{input => {required,{list,{ref,<<"UserInput">>}}},
        cwd => {optional,{any_of,[binstr,{exact,null}]}},
        threadId => {required,binstr},
        model => {optional,{any_of,[binstr,{exact,null}]}},
        summary =>
         {optional,{any_of,[{ref,<<"ReasoningSummary">>},{exact,null}]}},
        sandboxPolicy =>
         {optional,{any_of,[{ref,<<"SandboxPolicy">>},{exact,null}]}},
        approvalPolicy =>
         {optional,{any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
        effort =>
         {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
        outputSchema => {optional,term},
        personality =>
         {optional,{any_of,[{ref,<<"Personality">>},{exact,null}]}},
        collaborationMode =>
         {optional,{any_of,[{ref,<<"CollaborationMode">>},{exact,null}]}}}}}},
  from_json =>
   {with_defs,
    {#{<<"AbsolutePathBuf">> => binstr,
       <<"AskForApproval">> =>
        {enum,[untrusted,'on-failure','on-request',never]},
       <<"ByteRange">> =>
        {struct,#{start => {required,integer},'end' => {required,integer}}},
       <<"CollaborationMode">> =>
        {struct,
         #{mode => {required,{ref,<<"ModeKind">>}},
           settings => {required,{ref,<<"Settings">>}}}},
       <<"ModeKind">> => {enum,[plan,default]},
       <<"NetworkAccess">> => {enum,[restricted,enabled]},
       <<"Personality">> => {enum,[none,friendly,pragmatic]},
       <<"ReasoningEffort">> => {enum,[none,minimal,low,medium,high,xhigh]},
       <<"ReasoningSummary">> =>
        {any_of,[{enum,[auto,concise,detailed]},{enum,[none]}]},
       <<"SandboxPolicy">> =>
        {any_of,
         [{struct,#{type => {required,{enum,[dangerFullAccess]}}}},
          {struct,#{type => {required,{enum,[readOnly]}}}},
          {struct,
           #{type => {required,{enum,[externalSandbox]}},
             networkAccess =>
              {optional,
               {default,
                {<<"restricted">>,{all_of,[{ref,<<"NetworkAccess">>}]}}}}}},
          {struct,
           #{type => {required,{enum,[workspaceWrite]}},
             networkAccess => {optional,{default,{false,boolean}}},
             excludeSlashTmp => {optional,{default,{false,boolean}}},
             excludeTmpdirEnvVar => {optional,{default,{false,boolean}}},
             writableRoots =>
              {optional,{default,{[],{list,{ref,<<"AbsolutePathBuf">>}}}}}}}]},
       <<"Settings">> =>
        {struct,
         #{model => {required,binstr},
           developer_instructions => {optional,{any_of,[binstr,{exact,null}]}},
           reasoning_effort =>
            {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}}}},
       <<"TextElement">> =>
        {struct,
         #{byteRange => {required,{all_of,[{ref,<<"ByteRange">>}]}},
           placeholder => {optional,{any_of,[binstr,{exact,null}]}}}},
       <<"UserInput">> =>
        {any_of,
         [{struct,
           #{type => {required,{enum,[text]}},
             text => {required,binstr},
             text_elements =>
              {optional,{default,{[],{list,{ref,<<"TextElement">>}}}}}}},
          {struct,
           #{type => {required,{enum,[image]}},url => {required,binstr}}},
          {struct,
           #{type => {required,{enum,[localImage]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[skill]}},
             path => {required,binstr}}},
          {struct,
           #{name => {required,binstr},
             type => {required,{enum,[mention]}},
             path => {required,binstr}}}]}},
     {struct,
      #{input => {required,{list,{ref,<<"UserInput">>}}},
        cwd => {optional,{any_of,[binstr,{exact,null}]}},
        threadId => {required,binstr},
        model => {optional,{any_of,[binstr,{exact,null}]}},
        summary =>
         {optional,{any_of,[{ref,<<"ReasoningSummary">>},{exact,null}]}},
        sandboxPolicy =>
         {optional,{any_of,[{ref,<<"SandboxPolicy">>},{exact,null}]}},
        approvalPolicy =>
         {optional,{any_of,[{ref,<<"AskForApproval">>},{exact,null}]}},
        effort =>
         {optional,{any_of,[{ref,<<"ReasoningEffort">>},{exact,null}]}},
        outputSchema => {optional,term},
        personality =>
         {optional,{any_of,[{ref,<<"Personality">>},{exact,null}]}},
        collaborationMode =>
         {optional,{any_of,[{ref,<<"CollaborationMode">>},{exact,null}]}}}}}}}.
