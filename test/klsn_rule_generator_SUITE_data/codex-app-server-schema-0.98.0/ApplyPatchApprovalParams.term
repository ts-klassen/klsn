#{to_json =>
      {with_defs,
          {#{<<"FileChange">> =>
                 {any_of,
                     [{struct,
                          #{type => {required,{enum,[add]}},
                            content => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[delete]}},
                            content => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[update]}},
                            move_path =>
                                {optional,{any_of,[binstr,{exact,null}]}},
                            unified_diff => {required,binstr}}}]},
             <<"ThreadId">> => binstr},
           {struct,
               #{reason => {optional,{any_of,[binstr,{exact,null}]}},
                 callId => {required,binstr},
                 conversationId => {required,{ref,<<"ThreadId">>}},
                 fileChanges =>
                     {required,{map,{binstr,{ref,<<"FileChange">>}}}},
                 grantRoot => {optional,{any_of,[binstr,{exact,null}]}}}}}},
  from_json =>
      {with_defs,
          {#{<<"FileChange">> =>
                 {any_of,
                     [{struct,
                          #{type => {required,{enum,[add]}},
                            content => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[delete]}},
                            content => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[update]}},
                            move_path =>
                                {optional,{any_of,[binstr,{exact,null}]}},
                            unified_diff => {required,binstr}}}]},
             <<"ThreadId">> => binstr},
           {struct,
               #{reason => {optional,{any_of,[binstr,{exact,null}]}},
                 callId => {required,binstr},
                 conversationId => {required,{ref,<<"ThreadId">>}},
                 fileChanges =>
                     {required,{map,{binstr,{ref,<<"FileChange">>}}}},
                 grantRoot => {optional,{any_of,[binstr,{exact,null}]}}}}}}}.
