#{to_json =>
      {with_defs,
          {#{<<"ParsedCommand">> =>
                 {any_of,
                     [{struct,
                          #{name => {required,binstr},
                            type => {required,{enum,[read]}},
                            path => {required,binstr},
                            cmd => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[list_files]}},
                            path => {optional,{any_of,[binstr,{exact,null}]}},
                            cmd => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[search]}},
                            path => {optional,{any_of,[binstr,{exact,null}]}},
                            cmd => {required,binstr},
                            query =>
                                {optional,{any_of,[binstr,{exact,null}]}}}},
                      {struct,
                          #{type => {required,{enum,[unknown]}},
                            cmd => {required,binstr}}}]},
             <<"ThreadId">> => binstr},
           {struct,
               #{command => {required,{list,binstr}},
                 reason => {optional,{any_of,[binstr,{exact,null}]}},
                 cwd => {required,binstr},
                 callId => {required,binstr},
                 conversationId => {required,{ref,<<"ThreadId">>}},
                 parsedCmd => {required,{list,{ref,<<"ParsedCommand">>}}}}}}},
  from_json =>
      {with_defs,
          {#{<<"ParsedCommand">> =>
                 {any_of,
                     [{struct,
                          #{name => {required,binstr},
                            type => {required,{enum,[read]}},
                            path => {required,binstr},
                            cmd => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[list_files]}},
                            path => {optional,{any_of,[binstr,{exact,null}]}},
                            cmd => {required,binstr}}},
                      {struct,
                          #{type => {required,{enum,[search]}},
                            path => {optional,{any_of,[binstr,{exact,null}]}},
                            cmd => {required,binstr},
                            query =>
                                {optional,{any_of,[binstr,{exact,null}]}}}},
                      {struct,
                          #{type => {required,{enum,[unknown]}},
                            cmd => {required,binstr}}}]},
             <<"ThreadId">> => binstr},
           {struct,
               #{command => {required,{list,binstr}},
                 reason => {optional,{any_of,[binstr,{exact,null}]}},
                 cwd => {required,binstr},
                 callId => {required,binstr},
                 conversationId => {required,{ref,<<"ThreadId">>}},
                 parsedCmd => {required,{list,{ref,<<"ParsedCommand">>}}}}}}}}.
